/**
  Author:        Robin Grover
  Company:       Gusto
  Description:   This is a test class for HIFulfillmentEventEnrollment

  History
  7/11/2017    Robin Grover     Initial Implementation
  **/
@isTest
private class HIFulfillmentEventEnrlUnlockTest {

    static {
        Blob key = EncryptionUtils.generateKey('Master');
        Account testAcc = new Account(
            ZP_Company_ID__c = '7757616923599114',
            Name  = 'Test Account'
        );
        insert testAcc;

        Carrier__c testCarrier = new Carrier__c(
            Key__c = 'bcbs_ma',
            Name = 'Test Carrier',
            State__c = 'AL'
        );
        insert testCarrier;
    }
    static testMethod void insertingHIFulfillEventRecord() {
      
        HIFulfillmentEventTriggerHelper.queue = true;
        CaseTriggerHelper.skipTrigger=true;
        Case c = new Case();
        c.Enrollment_id__c='47431';
        c.Subject='Test';
        c.RecordTypeId=Cache.getRecordTypeId('Case', 'MF NHE');
        insert c;
        
        HI_Fulfillment_Event__c hiEventRec = new HI_Fulfillment_Event__c();
        hiEventRec.id__c = 'Test321';
        hiEventRec.Event_Type__c = 'enrollment_ready_for_processing';
        //hiEventRec.Event_Info__c =   '{"enrollment":{"id":47431,"employee_id":7757869431613363,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/enrollments/47431"},"recent_qles":[{"id":1682,"event":"marriage","date_of_event":"2017-05-26","file_upload_urls":[],"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/qualifying_life_events/1682"}],"carrier_directory":"https://confluence.gustocorp.com/pages/viewpage.action?pageId=28803132","employee":{"id":7757869431613363,"first_name":"Vincent","last_name":"Smitham","middle_initial":"M","status":"Active","ssn":"123456789","birthday":"1985-03-12","company_id":7757616923599114,"hired_at":"2014-05-12","employment_status":"full_time","home_address":{"id":7757727713689401,"street_1":"4349 Bradley Circles","street_2":"Suite 826","city":"Los Angeles","county_name":"Los Angeles","state":"CA","zip":"90027","country":"USA","phone":null,"created_at":"2016-12-14T14:36:45.000-08:00","updated_at":"2016-12-14T14:36:45.000-08:00","fax":null,"inactive":false,"work_address":false},"work_address":{"id":7757727713687976,"street_1":"427 Reilly Ramp","street_2":"Suite 475","city":"Los Angeles","county_name":"Los Angeles","state":"CA","zip":"90029","country":"USA","phone":"8899664872","created_at":"2016-12-13T17:35:24.000-08:00","updated_at":"2016-12-13T17:35:24.000-08:00","fax":null,"inactive":false,"work_address":true,"employee_count":6},"email":"schuyler.muller7757869449033705@turcottefisher.info","gender":"male","panda_url":"http://manage.zenpayroll.dev:3000/companies/7757616923599114/employees/7757869431613363","hippo_url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363"},"company":{"id":7757616923599114,"name":"Kihn, Cole and Turner","email":"justyn_dickens7757869449032810@bednar.com","salesforce_account_id":null,"work_states":["CA"],"sic_code":"6794","mailing_address":{"id":7757727713687976,"street_1":"427 Reilly Ramp","street_2":"Suite 475","city":"Los Angeles","county_name":"Los Angeles","state":"CA","zip":"90029","country":"USA","phone":"8899664872","created_at":"2016-12-13T17:35:24.000-08:00","updated_at":"2016-12-13T17:35:24.000-08:00","fax":null,"inactive":false,"work_address":true,"employee_count":6},"filing_address":{"id":7757727713687976,"street_1":"427 Reilly Ramp","street_2":"Suite 475","city":"Los Angeles","county_name":"Los Angeles","state":"CA","zip":"90029","country":"USA","phone":"8899664872","created_at":"2016-12-13T17:35:24.000-08:00","updated_at":"2016-12-13T17:35:24.000-08:00","fax":null,"inactive":false,"work_address":true,"employee_count":6},"benefits_address":{"id":7757727713687976,"street_1":"427 Reilly Ramp","street_2":"Suite 475","city":"Los Angeles","county_name":"Los Angeles","state":"CA","zip":"90029","country":"USA","phone":"8899664872","created_at":"2016-12-13T17:35:24.000-08:00","updated_at":"2016-12-13T17:35:24.000-08:00","fax":null,"inactive":false,"work_address":true,"employee_count":6},"number_of_eligible_ees":6,"number_of_ineligible_ees":0,"has_federal_cobra":null,"is_suspended":false,"panda_url":"http://manage.zenpayroll.dev:3000/companies/7757616923599114","hippo_url":"http://localhost:4001/companies/7757616923599114"},"state_carriers":[{"id":24,"name":"Principal","state":"CA","key":"principal_ca","url":"http://localhost:4001/national_carriers/48/state_carriers/24","carrier_enrollment_url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/enrollments/47431/principal_ca","forms":[]},{"id":5,"name":"Kaiser Permanente","state":"CA","key":"kaiser_ca","url":"http://localhost:4001/national_carriers/36/state_carriers/5","carrier_enrollment_url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/enrollments/47431/kaiser_ca","forms":[88268]}],"subscriptions":{"dental":{"current":null,"overlapping":[{"id":53794,"policy_id":15619,"benefit_type":"dental","subscriber_id":"22270388","start_date":"2017-03-01","end_date":"2018-02-28","processed":true,"enrollment_id":25666,"employee_id":7757869431613363,"dependent_ids":[],"state_carrier_id":24,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/53794"}],"previous":[]},"medical":{"current":{"id":98828,"policy_id":15841,"benefit_type":"medical","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":47431,"employee_id":7757869431613363,"dependent_ids":[16918],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/98828","estimated_start_date":"2017-05-26","estimated_total_premium":763.9,"estimated_employee_premium":375.63,"estimated_dependents_premium":388.27,"ops_owner":"member_fulfillment"},"overlapping":[{"id":53793,"policy_id":15842,"benefit_type":"medical","subscriber_id":"61306767","start_date":"2017-03-01","end_date":"2018-02-28","processed":true,"enrollment_id":25666,"employee_id":7757869431613363,"dependent_ids":[],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/53793"}],"previous":[]},"vision":{"current":{"id":98829,"policy_id":15634,"benefit_type":"vision","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":47431,"employee_id":7757869431613363,"dependent_ids":[16918],"state_carrier_id":24,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/98829","estimated_start_date":"2017-05-26","estimated_total_premium":19.51,"estimated_employee_premium":9.68,"estimated_dependents_premium":9.83,"ops_owner":"member_fulfillment"},"overlapping":[],"previous":[]}},"policies":[{"id":15619,"name":"Principal Dental Plan 4","benefit_type":"dental","group_number":"1073605-10001","policy_number":null,"plan_id":2224,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":24,"url":"http://localhost:4001/companies/7757616923599114/policies/15619"},{"id":15631,"name":"Silver 70 HMO 1000/50 + Child Dental Alt","benefit_type":"medical","group_number":"344089","policy_number":null,"plan_id":2419,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/policies/15631"},{"id":15634,"name":"Principal Vision Plan 2","benefit_type":"vision","group_number":"1073605-10001","policy_number":null,"plan_id":1975,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":24,"url":"http://localhost:4001/companies/7757616923599114/policies/15634"},{"id":15841,"name":"Platinum 90 HMO 0/10 + Child Dental Alt","benefit_type":"medical","group_number":"344089","policy_number":null,"plan_id":2413,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/policies/15841"},{"id":15842,"name":"Gold 80 HMO 0/30 w/ Child Dental, Acu","benefit_type":"medical","group_number":"344089","policy_number":null,"plan_id":2410,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/policies/15842"}],"dependents":[{"id":16918,"first_name":"Doug","last_name":"Wintheiser","ssn":"123456789","birthday":"1983-07-03","gender":"female","dependent_type":"spouse","employee_id":7757869431613363,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/dependents/16918"}],"forms":[{"id":88268,"name":"2017 Kaiser CA Employee Change Form","url":"http://localhost:4001/attachments/forms/88268"}],"answers":[],"subscriptions_url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions","enrollments_url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/enrollments"}';
        hiEventRec.Event_Info__c = '{\"enrollment\":{\"id\":47431,\"employee_id\":7757869431613363,\"url\":\"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/enrollments/47431\"},\"recent_qles\":[{\"id\":1682,\"event\":\"marriage\",\"date_of_event\":\"2017-05-26\",\"file_upload_urls\":[],\"url\":\"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/qualifying_life_events/1682\"}],\"carrier_directory\":\"https://confluence.gustocorp.com/pages/viewpage.action?pageId=28803132\",\"employee\":{\"id\":7757869431613363,\"first_name\":\"Vincent\",\"last_name\":\"Smitham\",\"middle_initial\":\"M\",\"status\":\"Active\",\"ssn\":\"123456789\",\"birthday\":\"1985-03-12\",\"company_id\":7757616923599114,\"hired_at\":\"2014-05-12\",\"employment_status\":\"full_time\",\"home_address\":{\"id\":7757727713689401,\"street_1\":\"4349 Bradley Circles\",\"street_2\":\"Suite 826\",\"city\":\"Los Angeles\",\"county_name\":\"Los Angeles\",\"state\":\"CA\",\"zip\":\"90027\",\"country\":\"USA\",\"phone\":null,\"created_at\":\"2016-12-14T14:36:45.000-08:00\",\"updated_at\":\"2016-12-14T14:36:45.000-08:00\",\"fax\":null,\"inactive\":false,\"work_address\":false},\"work_address\":{\"id\":7757727713687976,\"street_1\":\"427 O\'Reilly Ramp\",\"street_2\":\"Suite 475\",\"city\":\"Los Angeles\",\"county_name\":\"Los Angeles\",\"state\":\"CA\",\"zip\":\"90029\",\"country\":\"USA\",\"phone\":\"8899664872\",\"created_at\":\"2016-12-13T17:35:24.000-08:00\",\"updated_at\":\"2016-12-13T17:35:24.000-08:00\",\"fax\":null,\"inactive\":false,\"work_address\":true,\"employee_count\":6},\"email\":\"schuyler.muller7757869449033705@turcottefisher.info\",\"gender\":\"male\",\"panda_url\":\"http://manage.zenpayroll.dev:3000/companies/7757616923599114/employees/7757869431613363\",\"hippo_url\":\"http://localhost:4001/companies/7757616923599114/employees/7757869431613363\"},\"company\":{\"id\":7757616923599114,\"name\":\"Kihn, Cole and Turner\",\"email\":\"justyn_dickens7757869449032810@bednar.com\",\"salesforce_account_id\":null,\"work_states\":[\"CA\"],\"sic_code\":\"6794\",\"mailing_address\":{\"id\":7757727713687976,\"street_1\":\"427 O\'Reilly Ramp\",\"street_2\":\"Suite 475\",\"city\":\"Los Angeles\",\"county_name\":\"Los Angeles\",\"state\":\"CA\",\"zip\":\"90029\",\"country\":\"USA\",\"phone\":\"8899664872\",\"created_at\":\"2016-12-13T17:35:24.000-08:00\",\"updated_at\":\"2016-12-13T17:35:24.000-08:00\",\"fax\":null,\"inactive\":false,\"work_address\":true,\"employee_count\":6},\"filing_address\":{\"id\":7757727713687976,\"street_1\":\"427 O\'Reilly Ramp\",\"street_2\":\"Suite 475\",\"city\":\"Los Angeles\",\"county_name\":\"Los Angeles\",\"state\":\"CA\",\"zip\":\"90029\",\"country\":\"USA\",\"phone\":\"8899664872\",\"created_at\":\"2016-12-13T17:35:24.000-08:00\",\"updated_at\":\"2016-12-13T17:35:24.000-08:00\",\"fax\":null,\"inactive\":false,\"work_address\":true,\"employee_count\":6},\"benefits_address\":{\"id\":7757727713687976,\"street_1\":\"427 O\'Reilly Ramp\",\"street_2\":\"Suite 475\",\"city\":\"Los Angeles\",\"county_name\":\"Los Angeles\",\"state\":\"CA\",\"zip\":\"90029\",\"country\":\"USA\",\"phone\":\"8899664872\",\"created_at\":\"2016-12-13T17:35:24.000-08:00\",\"updated_at\":\"2016-12-13T17:35:24.000-08:00\",\"fax\":null,\"inactive\":false,\"work_address\":true,\"employee_count\":6},\"number_of_eligible_ees\":6,\"number_of_ineligible_ees\":0,\"has_federal_cobra\":null,\"is_suspended\":false,\"panda_url\":\"http://manage.zenpayroll.dev:3000/companies/7757616923599114\",\"hippo_url\":\"http://localhost:4001/companies/7757616923599114\"},\"state_carriers\":[{\"id\":24,\"name\":\"Principal\",\"state\":\"CA\",\"key\":\"principal_ca\",\"url\":\"http://localhost:4001/national_carriers/48/state_carriers/24\",\"carrier_enrollment_url\":\"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/enrollments/47431/principal_ca\",\"forms\":[]},{\"id\":5,\"name\":\"Kaiser Permanente\",\"state\":\"CA\",\"key\":\"kaiser_ca\",\"url\":\"http://localhost:4001/national_carriers/36/state_carriers/5\",\"carrier_enrollment_url\":\"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/enrollments/47431/kaiser_ca\",\"forms\":[88268]}],\"subscriptions\":{\"dental\":{\"current\":null,\"overlapping\":[{\"id\":53794,\"policy_id\":15619,\"benefit_type\":\"dental\",\"subscriber_id\":\"22270388\",\"start_date\":\"2017-03-01\",\"end_date\":\"2018-02-28\",\"processed\":true,\"enrollment_id\":25666,\"employee_id\":7757869431613363,\"dependent_ids\":[],\"state_carrier_id\":24,\"url\":\"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/53794\"}],\"previous\":[]},\"medical\":{\"current\":{\"id\":98828,\"policy_id\":15841,\"benefit_type\":\"medical\",\"subscriber_id\":null,\"start_date\":null,\"end_date\":null,\"processed\":false,\"enrollment_id\":47431,\"employee_id\":7757869431613363,\"dependent_ids\":[16918],\"state_carrier_id\":5,\"url\":\"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/98828\",\"estimated_start_date\":\"2017-05-26\",\"estimated_total_premium\":763.9,\"estimated_employee_premium\":375.63,\"estimated_dependents_premium\":388.27,\"ops_owner\":\"member_fulfillment\"},\"overlapping\":[{\"id\":53793,\"policy_id\":15842,\"benefit_type\":\"medical\",\"subscriber_id\":\"61306767\",\"start_date\":\"2017-03-01\",\"end_date\":\"2018-02-28\",\"processed\":true,\"enrollment_id\":25666,\"employee_id\":7757869431613363,\"dependent_ids\":[],\"state_carrier_id\":5,\"url\":\"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/53793\"}],\"previous\":[]},\"vision\":{\"current\":{\"id\":98829,\"policy_id\":15634,\"benefit_type\":\"vision\",\"subscriber_id\":null,\"start_date\":null,\"end_date\":null,\"processed\":false,\"enrollment_id\":47431,\"employee_id\":7757869431613363,\"dependent_ids\":[16918],\"state_carrier_id\":24,\"url\":\"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/98829\",\"estimated_start_date\":\"2017-05-26\",\"estimated_total_premium\":19.51,\"estimated_employee_premium\":9.68,\"estimated_dependents_premium\":9.83,\"ops_owner\":\"member_fulfillment\"},\"overlapping\":[],\"previous\":[]}},\"policies\":[{\"id\":15619,\"name\":\"Principal Dental Plan 4\",\"benefit_type\":\"dental\",\"group_number\":\"1073605-10001\",\"policy_number\":null,\"plan_id\":2224,\"visible\":true,\"termination_policy\":\"last_day_of_month_on_or_after_termination\",\"state_carrier_id\":24,\"url\":\"http://localhost:4001/companies/7757616923599114/policies/15619\"},{\"id\":15631,\"name\":\"Silver 70 HMO 1000/50 + Child Dental Alt\",\"benefit_type\":\"medical\",\"group_number\":\"344089\",\"policy_number\":null,\"plan_id\":2419,\"visible\":true,\"termination_policy\":\"last_day_of_month_on_or_after_termination\",\"state_carrier_id\":5,\"url\":\"http://localhost:4001/companies/7757616923599114/policies/15631\"},{\"id\":15634,\"name\":\"Principal Vision Plan 2\",\"benefit_type\":\"vision\",\"group_number\":\"1073605-10001\",\"policy_number\":null,\"plan_id\":1975,\"visible\":true,\"termination_policy\":\"last_day_of_month_on_or_after_termination\",\"state_carrier_id\":24,\"url\":\"http://localhost:4001/companies/7757616923599114/policies/15634\"},{\"id\":15841,\"name\":\"Platinum 90 HMO 0/10 + Child Dental Alt\",\"benefit_type\":\"medical\",\"group_number\":\"344089\",\"policy_number\":null,\"plan_id\":2413,\"visible\":true,\"termination_policy\":\"last_day_of_month_on_or_after_termination\",\"state_carrier_id\":5,\"url\":\"http://localhost:4001/companies/7757616923599114/policies/15841\"},{\"id\":15842,\"name\":\"Gold 80 HMO 0/30 w/ Child Dental, Acu\",\"benefit_type\":\"medical\",\"group_number\":\"344089\",\"policy_number\":null,\"plan_id\":2410,\"visible\":true,\"termination_policy\":\"last_day_of_month_on_or_after_termination\",\"state_carrier_id\":5,\"url\":\"http://localhost:4001/companies/7757616923599114/policies/15842\"}],\"dependents\":[{\"id\":16918,\"first_name\":\"Doug\",\"last_name\":\"Wintheiser\",\"ssn\":\"123456789\",\"birthday\":\"1983-07-03\",\"gender\":\"female\",\"dependent_type\":\"spouse\",\"employee_id\":7757869431613363,\"url\":\"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/dependents/16918\"}],\"forms\":[{\"id\":88268,\"name\":\"2017 Kaiser CA Employee Change Form\",\"url\":\"http://localhost:4001/attachments/forms/88268\"}],\"answers\":[],\"subscriptions_url\":\"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions\",\"enrollments_url\":\"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/enrollments\"}';

        insert hiEventRec;
        
        hiEventRec = new HI_Fulfillment_Event__c();
        hiEventRec.id__c = 'Test3211';
        hiEventRec.Event_Type__c = 'enrollment_unlocked';
        //hiEventRec.Event_Info__c =   '{"enrollment":{"id":47431,"employee_id":7757869431613363,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/enrollments/47431"},"recent_qles":[{"id":1682,"event":"marriage","date_of_event":"2017-05-26","file_upload_urls":[],"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/qualifying_life_events/1682"}],"carrier_directory":"https://confluence.gustocorp.com/pages/viewpage.action?pageId=28803132","employee":{"id":7757869431613363,"first_name":"Vincent","last_name":"Smitham","middle_initial":"M","status":"Active","ssn":"123456789","birthday":"1985-03-12","company_id":7757616923599114,"hired_at":"2014-05-12","employment_status":"full_time","home_address":{"id":7757727713689401,"street_1":"4349 Bradley Circles","street_2":"Suite 826","city":"Los Angeles","county_name":"Los Angeles","state":"CA","zip":"90027","country":"USA","phone":null,"created_at":"2016-12-14T14:36:45.000-08:00","updated_at":"2016-12-14T14:36:45.000-08:00","fax":null,"inactive":false,"work_address":false},"work_address":{"id":7757727713687976,"street_1":"427 Reilly Ramp","street_2":"Suite 475","city":"Los Angeles","county_name":"Los Angeles","state":"CA","zip":"90029","country":"USA","phone":"8899664872","created_at":"2016-12-13T17:35:24.000-08:00","updated_at":"2016-12-13T17:35:24.000-08:00","fax":null,"inactive":false,"work_address":true,"employee_count":6},"email":"schuyler.muller7757869449033705@turcottefisher.info","gender":"male","panda_url":"http://manage.zenpayroll.dev:3000/companies/7757616923599114/employees/7757869431613363","hippo_url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363"},"company":{"id":7757616923599114,"name":"Kihn, Cole and Turner","email":"justyn_dickens7757869449032810@bednar.com","salesforce_account_id":null,"work_states":["CA"],"sic_code":"6794","mailing_address":{"id":7757727713687976,"street_1":"427 Reilly Ramp","street_2":"Suite 475","city":"Los Angeles","county_name":"Los Angeles","state":"CA","zip":"90029","country":"USA","phone":"8899664872","created_at":"2016-12-13T17:35:24.000-08:00","updated_at":"2016-12-13T17:35:24.000-08:00","fax":null,"inactive":false,"work_address":true,"employee_count":6},"filing_address":{"id":7757727713687976,"street_1":"427 Reilly Ramp","street_2":"Suite 475","city":"Los Angeles","county_name":"Los Angeles","state":"CA","zip":"90029","country":"USA","phone":"8899664872","created_at":"2016-12-13T17:35:24.000-08:00","updated_at":"2016-12-13T17:35:24.000-08:00","fax":null,"inactive":false,"work_address":true,"employee_count":6},"benefits_address":{"id":7757727713687976,"street_1":"427 Reilly Ramp","street_2":"Suite 475","city":"Los Angeles","county_name":"Los Angeles","state":"CA","zip":"90029","country":"USA","phone":"8899664872","created_at":"2016-12-13T17:35:24.000-08:00","updated_at":"2016-12-13T17:35:24.000-08:00","fax":null,"inactive":false,"work_address":true,"employee_count":6},"number_of_eligible_ees":6,"number_of_ineligible_ees":0,"has_federal_cobra":null,"is_suspended":false,"panda_url":"http://manage.zenpayroll.dev:3000/companies/7757616923599114","hippo_url":"http://localhost:4001/companies/7757616923599114"},"state_carriers":[{"id":24,"name":"Principal","state":"CA","key":"principal_ca","url":"http://localhost:4001/national_carriers/48/state_carriers/24","carrier_enrollment_url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/enrollments/47431/principal_ca","forms":[]},{"id":5,"name":"Kaiser Permanente","state":"CA","key":"kaiser_ca","url":"http://localhost:4001/national_carriers/36/state_carriers/5","carrier_enrollment_url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/enrollments/47431/kaiser_ca","forms":[88268]}],"subscriptions":{"dental":{"current":null,"overlapping":[{"id":53794,"policy_id":15619,"benefit_type":"dental","subscriber_id":"22270388","start_date":"2017-03-01","end_date":"2018-02-28","processed":true,"enrollment_id":25666,"employee_id":7757869431613363,"dependent_ids":[],"state_carrier_id":24,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/53794"}],"previous":[]},"medical":{"current":{"id":98828,"policy_id":15841,"benefit_type":"medical","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":47431,"employee_id":7757869431613363,"dependent_ids":[16918],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/98828","estimated_start_date":"2017-05-26","estimated_total_premium":763.9,"estimated_employee_premium":375.63,"estimated_dependents_premium":388.27,"ops_owner":"member_fulfillment"},"overlapping":[{"id":53793,"policy_id":15842,"benefit_type":"medical","subscriber_id":"61306767","start_date":"2017-03-01","end_date":"2018-02-28","processed":true,"enrollment_id":25666,"employee_id":7757869431613363,"dependent_ids":[],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/53793"}],"previous":[]},"vision":{"current":{"id":98829,"policy_id":15634,"benefit_type":"vision","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":47431,"employee_id":7757869431613363,"dependent_ids":[16918],"state_carrier_id":24,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/98829","estimated_start_date":"2017-05-26","estimated_total_premium":19.51,"estimated_employee_premium":9.68,"estimated_dependents_premium":9.83,"ops_owner":"member_fulfillment"},"overlapping":[],"previous":[]}},"policies":[{"id":15619,"name":"Principal Dental Plan 4","benefit_type":"dental","group_number":"1073605-10001","policy_number":null,"plan_id":2224,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":24,"url":"http://localhost:4001/companies/7757616923599114/policies/15619"},{"id":15631,"name":"Silver 70 HMO 1000/50 + Child Dental Alt","benefit_type":"medical","group_number":"344089","policy_number":null,"plan_id":2419,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/policies/15631"},{"id":15634,"name":"Principal Vision Plan 2","benefit_type":"vision","group_number":"1073605-10001","policy_number":null,"plan_id":1975,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":24,"url":"http://localhost:4001/companies/7757616923599114/policies/15634"},{"id":15841,"name":"Platinum 90 HMO 0/10 + Child Dental Alt","benefit_type":"medical","group_number":"344089","policy_number":null,"plan_id":2413,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/policies/15841"},{"id":15842,"name":"Gold 80 HMO 0/30 w/ Child Dental, Acu","benefit_type":"medical","group_number":"344089","policy_number":null,"plan_id":2410,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/policies/15842"}],"dependents":[{"id":16918,"first_name":"Doug","last_name":"Wintheiser","ssn":"123456789","birthday":"1983-07-03","gender":"female","dependent_type":"spouse","employee_id":7757869431613363,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/dependents/16918"}],"forms":[{"id":88268,"name":"2017 Kaiser CA Employee Change Form","url":"http://localhost:4001/attachments/forms/88268"}],"answers":[],"subscriptions_url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions","enrollments_url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/enrollments"}';
        hiEventRec.Event_Info__c = '{\"enrollment\":{\"id\":47431,\"employee_id\":7757869431613363,\"url\":\"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/enrollments/47431\"},\"recent_qles\":[{\"id\":1682,\"event\":\"marriage\",\"date_of_event\":\"2017-05-26\",\"file_upload_urls\":[],\"url\":\"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/qualifying_life_events/1682\"}],\"carrier_directory\":\"https://confluence.gustocorp.com/pages/viewpage.action?pageId=28803132\",\"employee\":{\"id\":7757869431613363,\"first_name\":\"Vincent\",\"last_name\":\"Smitham\",\"middle_initial\":\"M\",\"status\":\"Active\",\"ssn\":\"123456789\",\"birthday\":\"1985-03-12\",\"company_id\":7757616923599114,\"hired_at\":\"2014-05-12\",\"employment_status\":\"full_time\",\"home_address\":{\"id\":7757727713689401,\"street_1\":\"4349 Bradley Circles\",\"street_2\":\"Suite 826\",\"city\":\"Los Angeles\",\"county_name\":\"Los Angeles\",\"state\":\"CA\",\"zip\":\"90027\",\"country\":\"USA\",\"phone\":null,\"created_at\":\"2016-12-14T14:36:45.000-08:00\",\"updated_at\":\"2016-12-14T14:36:45.000-08:00\",\"fax\":null,\"inactive\":false,\"work_address\":false},\"work_address\":{\"id\":7757727713687976,\"street_1\":\"427 O\'Reilly Ramp\",\"street_2\":\"Suite 475\",\"city\":\"Los Angeles\",\"county_name\":\"Los Angeles\",\"state\":\"CA\",\"zip\":\"90029\",\"country\":\"USA\",\"phone\":\"8899664872\",\"created_at\":\"2016-12-13T17:35:24.000-08:00\",\"updated_at\":\"2016-12-13T17:35:24.000-08:00\",\"fax\":null,\"inactive\":false,\"work_address\":true,\"employee_count\":6},\"email\":\"schuyler.muller7757869449033705@turcottefisher.info\",\"gender\":\"male\",\"panda_url\":\"http://manage.zenpayroll.dev:3000/companies/7757616923599114/employees/7757869431613363\",\"hippo_url\":\"http://localhost:4001/companies/7757616923599114/employees/7757869431613363\"},\"company\":{\"id\":7757616923599114,\"name\":\"Kihn, Cole and Turner\",\"email\":\"justyn_dickens7757869449032810@bednar.com\",\"salesforce_account_id\":null,\"work_states\":[\"CA\"],\"sic_code\":\"6794\",\"mailing_address\":{\"id\":7757727713687976,\"street_1\":\"427 O\'Reilly Ramp\",\"street_2\":\"Suite 475\",\"city\":\"Los Angeles\",\"county_name\":\"Los Angeles\",\"state\":\"CA\",\"zip\":\"90029\",\"country\":\"USA\",\"phone\":\"8899664872\",\"created_at\":\"2016-12-13T17:35:24.000-08:00\",\"updated_at\":\"2016-12-13T17:35:24.000-08:00\",\"fax\":null,\"inactive\":false,\"work_address\":true,\"employee_count\":6},\"filing_address\":{\"id\":7757727713687976,\"street_1\":\"427 O\'Reilly Ramp\",\"street_2\":\"Suite 475\",\"city\":\"Los Angeles\",\"county_name\":\"Los Angeles\",\"state\":\"CA\",\"zip\":\"90029\",\"country\":\"USA\",\"phone\":\"8899664872\",\"created_at\":\"2016-12-13T17:35:24.000-08:00\",\"updated_at\":\"2016-12-13T17:35:24.000-08:00\",\"fax\":null,\"inactive\":false,\"work_address\":true,\"employee_count\":6},\"benefits_address\":{\"id\":7757727713687976,\"street_1\":\"427 O\'Reilly Ramp\",\"street_2\":\"Suite 475\",\"city\":\"Los Angeles\",\"county_name\":\"Los Angeles\",\"state\":\"CA\",\"zip\":\"90029\",\"country\":\"USA\",\"phone\":\"8899664872\",\"created_at\":\"2016-12-13T17:35:24.000-08:00\",\"updated_at\":\"2016-12-13T17:35:24.000-08:00\",\"fax\":null,\"inactive\":false,\"work_address\":true,\"employee_count\":6},\"number_of_eligible_ees\":6,\"number_of_ineligible_ees\":0,\"has_federal_cobra\":null,\"is_suspended\":false,\"panda_url\":\"http://manage.zenpayroll.dev:3000/companies/7757616923599114\",\"hippo_url\":\"http://localhost:4001/companies/7757616923599114\"},\"state_carriers\":[{\"id\":24,\"name\":\"Principal\",\"state\":\"CA\",\"key\":\"principal_ca\",\"url\":\"http://localhost:4001/national_carriers/48/state_carriers/24\",\"carrier_enrollment_url\":\"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/enrollments/47431/principal_ca\",\"forms\":[]},{\"id\":5,\"name\":\"Kaiser Permanente\",\"state\":\"CA\",\"key\":\"kaiser_ca\",\"url\":\"http://localhost:4001/national_carriers/36/state_carriers/5\",\"carrier_enrollment_url\":\"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/enrollments/47431/kaiser_ca\",\"forms\":[88268]}],\"subscriptions\":{\"dental\":{\"current\":null,\"overlapping\":[{\"id\":53794,\"policy_id\":15619,\"benefit_type\":\"dental\",\"subscriber_id\":\"22270388\",\"start_date\":\"2017-03-01\",\"end_date\":\"2018-02-28\",\"processed\":true,\"enrollment_id\":25666,\"employee_id\":7757869431613363,\"dependent_ids\":[],\"state_carrier_id\":24,\"url\":\"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/53794\"}],\"previous\":[]},\"medical\":{\"current\":{\"id\":98828,\"policy_id\":15841,\"benefit_type\":\"medical\",\"subscriber_id\":null,\"start_date\":null,\"end_date\":null,\"processed\":false,\"enrollment_id\":47431,\"employee_id\":7757869431613363,\"dependent_ids\":[16918],\"state_carrier_id\":5,\"url\":\"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/98828\",\"estimated_start_date\":\"2017-05-26\",\"estimated_total_premium\":763.9,\"estimated_employee_premium\":375.63,\"estimated_dependents_premium\":388.27,\"ops_owner\":\"member_fulfillment\"},\"overlapping\":[{\"id\":53793,\"policy_id\":15842,\"benefit_type\":\"medical\",\"subscriber_id\":\"61306767\",\"start_date\":\"2017-03-01\",\"end_date\":\"2018-02-28\",\"processed\":true,\"enrollment_id\":25666,\"employee_id\":7757869431613363,\"dependent_ids\":[],\"state_carrier_id\":5,\"url\":\"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/53793\"}],\"previous\":[]},\"vision\":{\"current\":{\"id\":98829,\"policy_id\":15634,\"benefit_type\":\"vision\",\"subscriber_id\":null,\"start_date\":null,\"end_date\":null,\"processed\":false,\"enrollment_id\":47431,\"employee_id\":7757869431613363,\"dependent_ids\":[16918],\"state_carrier_id\":24,\"url\":\"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/98829\",\"estimated_start_date\":\"2017-05-26\",\"estimated_total_premium\":19.51,\"estimated_employee_premium\":9.68,\"estimated_dependents_premium\":9.83,\"ops_owner\":\"member_fulfillment\"},\"overlapping\":[],\"previous\":[]}},\"policies\":[{\"id\":15619,\"name\":\"Principal Dental Plan 4\",\"benefit_type\":\"dental\",\"group_number\":\"1073605-10001\",\"policy_number\":null,\"plan_id\":2224,\"visible\":true,\"termination_policy\":\"last_day_of_month_on_or_after_termination\",\"state_carrier_id\":24,\"url\":\"http://localhost:4001/companies/7757616923599114/policies/15619\"},{\"id\":15631,\"name\":\"Silver 70 HMO 1000/50 + Child Dental Alt\",\"benefit_type\":\"medical\",\"group_number\":\"344089\",\"policy_number\":null,\"plan_id\":2419,\"visible\":true,\"termination_policy\":\"last_day_of_month_on_or_after_termination\",\"state_carrier_id\":5,\"url\":\"http://localhost:4001/companies/7757616923599114/policies/15631\"},{\"id\":15634,\"name\":\"Principal Vision Plan 2\",\"benefit_type\":\"vision\",\"group_number\":\"1073605-10001\",\"policy_number\":null,\"plan_id\":1975,\"visible\":true,\"termination_policy\":\"last_day_of_month_on_or_after_termination\",\"state_carrier_id\":24,\"url\":\"http://localhost:4001/companies/7757616923599114/policies/15634\"},{\"id\":15841,\"name\":\"Platinum 90 HMO 0/10 + Child Dental Alt\",\"benefit_type\":\"medical\",\"group_number\":\"344089\",\"policy_number\":null,\"plan_id\":2413,\"visible\":true,\"termination_policy\":\"last_day_of_month_on_or_after_termination\",\"state_carrier_id\":5,\"url\":\"http://localhost:4001/companies/7757616923599114/policies/15841\"},{\"id\":15842,\"name\":\"Gold 80 HMO 0/30 w/ Child Dental, Acu\",\"benefit_type\":\"medical\",\"group_number\":\"344089\",\"policy_number\":null,\"plan_id\":2410,\"visible\":true,\"termination_policy\":\"last_day_of_month_on_or_after_termination\",\"state_carrier_id\":5,\"url\":\"http://localhost:4001/companies/7757616923599114/policies/15842\"}],\"dependents\":[{\"id\":16918,\"first_name\":\"Doug\",\"last_name\":\"Wintheiser\",\"ssn\":\"123456789\",\"birthday\":\"1983-07-03\",\"gender\":\"female\",\"dependent_type\":\"spouse\",\"employee_id\":7757869431613363,\"url\":\"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/dependents/16918\"}],\"forms\":[{\"id\":88268,\"name\":\"2017 Kaiser CA Employee Change Form\",\"url\":\"http://localhost:4001/attachments/forms/88268\"}],\"answers\":[],\"subscriptions_url\":\"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions\",\"enrollments_url\":\"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/enrollments\"}';

        insert hiEventRec;
        
        HIFulfillmentEventEnrllmentUnlock jsonH =new HIFulfillmentEventEnrllmentUnlock();
        list<HI_Fulfillment_Event__c> hiEventRecList = [select id__c from HI_Fulfillment_Event__c];
        
        system.assert(hiEventRecList.size()>0);

        HIFulfillmentEventTriggerHelper.setProcessingState(IntegrationUtils.DEAD_STATE, 'Test', new HI_Fulfillment_Event__c());
        
        update hiEventRec;
        
        delete hiEventRec;
        undelete hiEventRec;

    }
}