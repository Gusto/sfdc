@isTest
private class HIBotGetEnrollmentServiceTest {
	private static Carrier__c testCarrier;
	private static Group grp;
	static {
		Blob key = EncryptionUtils.generateKey('Master');
		Account testAcc = new Account(ZP_Company_ID__c = '7757616923585579', Name = 'Test Account');
		insert testAcc;

		testCarrier = new Carrier__c(Key__c = 'united_ca', Name = 'Test Carrier', State__c = 'AL', Carrier_Id__c = '60', Id__c = '60');
		insert testCarrier;

		HIFulfillmentEventTriggerHelper.queue = true;

		List<HI_Fulfillment_Event__c> eventList = new List<HI_Fulfillment_Event__c>();

		HI_Fulfillment_Event__c hiEventRec = new HI_Fulfillment_Event__c();
		hiEventRec.id__c = 'Test321';
		hiEventRec.Event_Type__c = 'enrollment_ready_for_processing';
		hiEventRec.Event_Info__c = '{"enrollment":{"id":485649,"employee_id":7757869432016292,"url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292/enrollments/485649"},"recent_qles":[],"carrier_directory":"https://confluence.gustocorp.com/pages/viewpage.action?pageId=28803132","employee":{"id":7757869432016292,"first_name":"Domingo","last_name":"Auer","middle_initial":"","status":"Active","ssn":"123456789","birthday":"1969-06-24","company_id":7757616923585579,"hired_at":"2018-01-22","employment_status":"full_time","home_address":{"id":7757869431742334,"fax":"2132987095","zip":"95134","city":"San Jose","phone":"9157637101","state":"CA","country":"USA","inactive":false,"street_1":"1603 Abraham Gateway","street_2":"Suite 731","created_at":"2018-01-24T12:22:24.000-08:00","updated_at":"2018-01-24T12:22:24.000-08:00","county_name":"Santa Clara","work_address":false},"work_address":{"id":7757869432017410,"fax":"4524600800","zip":"94043","city":"Mountain View","phone":"6851496754","state":"CA","country":"USA","inactive":false,"street_1":"84517 Jacinto Curve","street_2":"Suite 664","created_at":"2018-05-22T11:06:02.000-07:00","updated_at":"2018-05-22T11:06:02.000-07:00","county_name":"Santa Clara","work_address":true},"email":"shawnna@mante.com","gender":"female","annual_salary":"165000.0","benefits_eligibility_date":"2018-01-22","panda_url":"http://manage.gusto-dev.com:3000/companies/7757616923585579/employees/7757869432016292","hippo_url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292"},"company":{"id":7757616923585579,"name":"Windler-Gottlieb","email":"maple@kunzeframi.com","salesforce_account_id":"0011600001yQVXmAAO","work_states":["AZ","CA","DC","FL","MA","MD","NV","WI"],"sic_code":"7379","mailing_address":{"id":7757869432017410,"fax":"7056301777","zip":"94043","city":"Mountain View","phone":"7898678573","state":"CA","country":"USA","inactive":false,"street_1":"63732 Wolf River","street_2":"Apt. 519","created_at":"2018-05-22T11:06:02.000-07:00","updated_at":"2018-05-22T11:06:02.000-07:00","county_name":"Santa Clara","work_address":true,"employee_count":81},"filing_address":{"id":7757869432017410,"fax":"6023353384","zip":"94043","city":"Mountain View","phone":"7043937192","state":"CA","country":"USA","inactive":false,"street_1":"571 McClure Fords","street_2":"Apt. 459","created_at":"2018-05-22T11:06:02.000-07:00","updated_at":"2018-05-22T11:06:02.000-07:00","county_name":"Santa Clara","work_address":true,"employee_count":81},"benefits_address":{"id":7757869432017410,"fax":"6023353384","zip":"94043","city":"Mountain View","phone":"7043937192","state":"CA","country":"USA","inactive":false,"street_1":"571 McClure Fords","street_2":"Apt. 459","created_at":"2018-05-22T11:06:02.000-07:00","updated_at":"2018-05-22T11:06:02.000-07:00","county_name":"Santa Clara","work_address":true,"employee_count":81},"number_of_eligible_ees":60,"number_of_ineligible_ees":11,"has_federal_cobra":true,"is_suspended":false,"panda_url":"http://manage.gusto-dev.com:3000/companies/7757616923585579","hippo_url":"http://localhost:4001/companies/7757616923585579","google_drive_folder_url":"No Google Drive folder set up"},"state_carriers":[{"id":11,"name":"United","state":"CA","key":"united_ca","url":"http://localhost:4001/national_carriers/9/state_carriers/11","carrier_enrollment_url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292/enrollments/485649/cal_choice_ca","forms":[950452]},{"id":3,"name":"Delta Dental","state":"CA","key":"delta_ca","url":"http://localhost:4001/national_carriers/15/state_carriers/3","carrier_enrollment_url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292/enrollments/485649/delta_ca","forms":[950453]},{"id":7,"name":"VSP","state":"CA","key":"vsp_ca","url":"http://localhost:4001/national_carriers/62/state_carriers/7","carrier_enrollment_url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292/enrollments/485649/vsp_ca","forms":[950454]}],"benefit_items":{"medical":{"current":{"id":1028647,"policy_id":85860,"benefit_type":"medical","subscriber_id":null,"processing_status":"not_started","start_date":null,"end_date":null,"enrollment_id":485649,"employee_id":7757869432016292,"dependent_ids":[35570],"state_carrier_id":11,"url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292/selections/1028647","estimated_start_date":"2019-05-31","estimated_total_premium":1072.79,"estimated_employee_premium":445.11,"estimated_dependents_premium":627.68,"ops_owner":"member_fulfillment"},"overlapping":[{"id":475436,"policy_id":85860,"benefit_type":"medical","subscriber_id":"88705326","processing_status":"processed","start_date":"2019-01-01","end_date":"2019-12-31","enrollment_id":347657,"employee_id":7757869432016292,"dependent_ids":[],"state_carrier_id":11,"url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292/subscriptions/475436"}],"previous":[]},"dental":{"current":{"id":1028648,"policy_id":85862,"benefit_type":"dental","subscriber_id":null,"processing_status":"not_started","start_date":null,"end_date":null,"enrollment_id":485649,"employee_id":7757869432016292,"dependent_ids":[35570],"state_carrier_id":3,"url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292/selections/1028648","estimated_start_date":"2019-05-31","estimated_total_premium":130.58,"estimated_employee_premium":64.13,"estimated_dependents_premium":66.45,"ops_owner":"member_fulfillment"},"overlapping":[{"id":475500,"policy_id":85862,"benefit_type":"dental","subscriber_id":"90349987","processing_status":"processed","start_date":"2019-01-01","end_date":"2019-12-31","enrollment_id":347657,"employee_id":7757869432016292,"dependent_ids":[],"state_carrier_id":3,"url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292/subscriptions/475500"}],"previous":[]},"vision":{"current":{"id":1028649,"policy_id":85863,"benefit_type":"vision","subscriber_id":null,"processing_status":"not_started","start_date":null,"end_date":null,"enrollment_id":485649,"employee_id":7757869432016292,"dependent_ids":[35570],"state_carrier_id":7,"url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292/selections/1028649","estimated_start_date":"2019-05-31","estimated_total_premium":16.12,"estimated_employee_premium":10.38,"estimated_dependents_premium":5.74,"ops_owner":"member_fulfillment"},"overlapping":[{"id":475530,"policy_id":85863,"benefit_type":"vision","subscriber_id":"71652644","processing_status":"processed","start_date":"2019-01-01","end_date":"2019-12-31","enrollment_id":347657,"employee_id":7757869432016292,"dependent_ids":[],"state_carrier_id":7,"url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292/subscriptions/475530"}],"previous":[]}},"policies":[{"id":85860,"name":"CalChoice Anthem Gold Select PPO C","benefit_type":"medical","group_number":"58000202","policy_number":null,"plan_id":18064,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":11,"url":"http://localhost:4001/companies/7757616923585579/policies/85860"},{"id":85861,"name":"CalChoice Kaiser Platinum Full HMO A","benefit_type":"medical","group_number":"96361069","policy_number":null,"plan_id":18088,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":11,"url":"http://localhost:4001/companies/7757616923585579/policies/85861"},{"id":85862,"name":"Delta Dental PPO Plus Premier Enhanced [VolkScience]","benefit_type":"dental","group_number":"96405913","policy_number":null,"plan_id":8967,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":3,"url":"http://localhost:4001/companies/7757616923585579/policies/85862"},{"id":85863,"name":"VSP Signature Plan [Volkscience]","benefit_type":"vision","group_number":"62972822","policy_number":null,"plan_id":8968,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":7,"url":"http://localhost:4001/companies/7757616923585579/policies/85863"}],"dependents":[{"id":35570,"first_name":"Arlinda","last_name":"Brakus","ssn":"123456789","birthday":"1980-12-04","gender":"male","dependent_type":"spouse","employee_id":7757869432016292,"url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292/dependents/35570"}],"forms":[{"id":950454,"name":"VSP Enrollment Form","signed_at":"2019-06-30T21:35:02.972-07:00","url":"http://localhost:4001/attachments/forms/950454"},{"id":950453,"name":"2017 Delta Change Form","signed_at":"2019-06-30T21:35:11.390-07:00","url":"http://localhost:4001/attachments/forms/950453"},{"id":950452,"name":"2019 CalChoice EE Change Form / QLE Form","signed_at":"2019-06-30T21:35:16.320-07:00","url":"http://localhost:4001/attachments/forms/950452"}],"answers":[],"benefits_url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292/benefits","enrollments_url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292/enrollments","alegeus":{"fsa":{"benefit_items":{"current":null,"overlapping":[],"previous":[]},"policies":[{"id":86321,"name":"Health FSA","benefit_type":"fsa","company_alegeus_id":314732886,"visible":true,"termination_policy":"last_day_of_employment","url":"http://localhost:4001/companies/7757616923585579/policies/86321"}]}}}';
        
		hiEventRec.id__c = 'Test421';
		hiEventRec.Event_Type__c = 'employee_losing_eligibility';
		hiEventRec.Event_Info__c = '{"losing_benefits_date":"2017-07-27","losing_benefits_reason":"Termination","carrier_directory":"https://confluence.gustocorp.com/pages/viewpage.action?pageId=28803132","employee":{"id":7757869431795591,"first_name":"Eileen","last_name":"Koepp","middle_initial":"","status":"Active","ssn":"123456789","birthday":"1981-08-14","company_id":7757616923585579,"hired_at":"2017-07-10","employment_status":"full_time","home_address":{"id":7757727714014570,"street_1":"6198 Elaina Inlet","street_2":"Suite 639","city":"San Francisco","county_name":"San Francisco","state":"CA","zip":"94109","country":"USA","phone":null,"created_at":"2017-07-05T15:26:28.000-07:00","updated_at":"2017-07-05T15:26:28.000-07:00","fax":null,"inactive":false,"work_address":false},"work_address":{"id":1383002648546509,"street_1":"88464 Harmon Pine","street_2":"Suite 812","city":"San Francisco","county_name":"San Francisco","state":"CA","zip":"94107","country":"USA","phone":"7944174714","created_at":"2013-10-28T16:24:08.000-07:00","updated_at":"2016-05-25T08:12:58.000-07:00","fax":"3587335331","inactive":false,"work_address":true,"employee_count":61},"email":"tamia7757869449269353@uptonreynolds.com","gender":"male","panda_url":"http://manage.zenpayroll.dev:3000/companies/1370368242490000/employees/7757869431795591","hippo_url":"http://localhost:4001/companies/1370368242490000/employees/7757869431795591","payroll_type":"Exempt"},"company":{"id":7757616923585579,"name":"Homenick-Aufderhar","email":"hollie_haley7757869448810741@ernser.name","salesforce_account_id":null,"work_states":["CA"],"sic_code":"8999","mailing_address":{"id":1383002648546509,"street_1":"88464 Harmon Pine","street_2":"Suite 812","city":"San Francisco","county_name":"San Francisco","state":"CA","zip":"94107","country":"USA","phone":"7944174714","created_at":"2013-10-28T16:24:08.000-07:00","updated_at":"2016-05-25T08:12:58.000-07:00","fax":"3587335331","inactive":false,"work_address":true,"employee_count":61},"filing_address":{"id":1383002648546509,"street_1":"88464 Harmon Pine","street_2":"Suite 812","city":"San Francisco","county_name":"San Francisco","state":"CA","zip":"94107","country":"USA","phone":"7944174714","created_at":"2013-10-28T16:24:08.000-07:00","updated_at":"2016-05-25T08:12:58.000-07:00","fax":"3587335331","inactive":false,"work_address":true,"employee_count":61},"benefits_address":{"id":1383002648546509,"street_1":"88464 Harmon Pine","street_2":"Suite 812","city":"San Francisco","county_name":"San Francisco","state":"CA","zip":"94107","country":"USA","phone":"7944174714","created_at":"2013-10-28T16:24:08.000-07:00","updated_at":"2016-05-25T08:12:58.000-07:00","fax":"3587335331","inactive":false,"work_address":true,"employee_count":61},"number_of_eligible_ees":39,"number_of_ineligible_ees":2,"has_federal_cobra":true,"is_suspended":false,"panda_url":"http://manage.zenpayroll.dev:3000/companies/1370368242490000","hippo_url":"http://localhost:4001/companies/1370368242490000"},"state_carriers":[{"id":60,"name":"Guardian","state":"CA","key":"united_ca","url":"http://localhost:4001/national_carriers/24/state_carriers/22","forms":[]},{"id":2,"name":"Blue Shield of California","state":"CA","key":"blue_shield_ca","url":"http://localhost:4001/national_carriers/8/state_carriers/2","forms":[]}],"subscriptions":[{"id":103300,"policy_id":3043,"benefit_type":"dental","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":48910,"employee_id":7757869431795591,"dependent_ids":[],"state_carrier_id":60,"url":"http://localhost:4001/companies/1370368242490000/employees/7757869431795591/subscriptions/103300","total_premium":58.36},{"id":103301,"policy_id":3044,"benefit_type":"vision","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":48910,"employee_id":7757869431795591,"dependent_ids":[],"state_carrier_id":60,"url":"http://localhost:4001/companies/1370368242490000/employees/7757869431795591/subscriptions/103301","total_premium":13.44},{"id":103298,"policy_id":8401,"benefit_type":"medical","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":48910,"employee_id":7757869431795591,"dependent_ids":[],"state_carrier_id":60,"url":"http://localhost:4001/companies/1370368242490000/employees/7757869431795591/subscriptions/103298","total_premium":742.56}],"policies":[{"id":3043,"name":"DentalGuard Preferred [Lob.com]","benefit_type":"dental","group_number":"501254","policy_number":null,"plan_id":163,"visible":true,"termination_policy":null,"state_carrier_id":60,"url":"http://localhost:4001/companies/1370368242490000/policies/3043"},{"id":3044,"name":"VSP Signature Full Feature [Lob.com]","benefit_type":"vision","group_number":"501254","policy_number":null,"plan_id":164,"visible":true,"termination_policy":null,"state_carrier_id":60,"url":"http://localhost:4001/companies/1370368242490000/policies/3044"},{"id":8401,"name":"Platinum Full PPO 0/10 OffEx","benefit_type":"medical","group_number":"W0076882","policy_number":null,"plan_id":952,"visible":true,"termination_policy":null,"state_carrier_id":60,"url":"http://localhost:4001/companies/1370368242490000/policies/8401"}],"dependents":[],"forms":[],"tada":{"dca":{"subscriptions":[],"policies":[]},"fsa":{"subscriptions":[{"id":103302,"policy_id":26484,"benefit_type":"fsa","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":48910,"employee_id":7757869431795591,"employee_alegeus_id":218828899,"dependent_ids":[],"url":"http://localhost:4001/companies/1370368242490000/employees/7757869431795591/subscriptions/103302"}],"policies":[{"id":26484,"name":"Health FSA","benefit_type":"fsa","company_alegeus_id":964954019,"visible":true,"termination_policy":"last_day_of_employment","url":"http://localhost:4001/companies/1370368242490000/policies/26484","provider_key": "alegeus"}]},"hsa":{}},"subscriptions_url":"http://localhost:4001/companies/1370368242490000/employees/7757869431795591/subscriptions","dependents_url":"http://localhost:4001/companies/1370368242490000/employees/7757869431795591/dependents","commuter_benefit":{"provider_key": "alegeus","id":3,"company_id":1408063107892611,"status":"processed","start_date":"2017-09-01","end_date":null,"upcoming":false,"active":true,"expired":false,"waiting_period":"first_of_month_following_hire","company_contribution_inputs":{"type":"fixed_amount","parking_contribution_amount":"0","transit_contribution_amount":"255"},"url":"https://hippo.gusto.com/companies/1408063107892611/commuter_benefits/3"},"commuter_employee_benefit":{"id":4,"employee_id":7757869431686263,"commuter_benefit_id":3,"status":"processed","start_date":"2017-09-01","transit_monthly_election":"255.0","transit_monthly_contribution":"255.0","transit_monthly_deduction":"0.0","parking_monthly_election":"0.0","parking_monthly_contribution":"0.0","parking_monthly_deduction":"0.0","url":"https://hippo.gusto.com/companies/1408063107892611/employees/7757869431686263/commuter_employee_benefits/4","commuter_benefit_url":"https://hippo.gusto.com/companies/1408063107892611/commuter_benefits/3"}}';
		hiEventRec.Employee_id__c = '7757869431795591';
	}

	static testMethod void insertingHIFulfillEventRecord() {
		HI_Fulfillment_Event__c hiEventRec = new HI_Fulfillment_Event__c();
		hiEventRec.id__c = 'Test321';
		hiEventRec.Event_Type__c = 'enrollment_ready_for_processing';
		hiEventRec.Event_Info__c = '{"enrollment":{"id":485649,"employee_id":7757869432016292,"url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292/enrollments/485649"},"recent_qles":[],"carrier_directory":"https://confluence.gustocorp.com/pages/viewpage.action?pageId=28803132","employee":{"id":7757869432016292,"first_name":"Domingo","last_name":"Auer","middle_initial":"","status":"Active","ssn":"123456789","birthday":"1969-06-24","company_id":7757616923585579,"hired_at":"2018-01-22","employment_status":"full_time","home_address":{"id":7757869431742334,"fax":"2132987095","zip":"95134","city":"San Jose","phone":"9157637101","state":"CA","country":"USA","inactive":false,"street_1":"1603 Abraham Gateway","street_2":"Suite 731","created_at":"2018-01-24T12:22:24.000-08:00","updated_at":"2018-01-24T12:22:24.000-08:00","county_name":"Santa Clara","work_address":false},"work_address":{"id":7757869432017410,"fax":"4524600800","zip":"94043","city":"Mountain View","phone":"6851496754","state":"CA","country":"USA","inactive":false,"street_1":"84517 Jacinto Curve","street_2":"Suite 664","created_at":"2018-05-22T11:06:02.000-07:00","updated_at":"2018-05-22T11:06:02.000-07:00","county_name":"Santa Clara","work_address":true},"email":"shawnna@mante.com","gender":"female","annual_salary":"165000.0","benefits_eligibility_date":"2018-01-22","panda_url":"http://manage.gusto-dev.com:3000/companies/7757616923585579/employees/7757869432016292","hippo_url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292"},"company":{"id":7757616923585579,"name":"Windler-Gottlieb","email":"maple@kunzeframi.com","salesforce_account_id":"0011600001yQVXmAAO","work_states":["AZ","CA","DC","FL","MA","MD","NV","WI"],"sic_code":"7379","mailing_address":{"id":7757869432017410,"fax":"7056301777","zip":"94043","city":"Mountain View","phone":"7898678573","state":"CA","country":"USA","inactive":false,"street_1":"63732 Wolf River","street_2":"Apt. 519","created_at":"2018-05-22T11:06:02.000-07:00","updated_at":"2018-05-22T11:06:02.000-07:00","county_name":"Santa Clara","work_address":true,"employee_count":81},"filing_address":{"id":7757869432017410,"fax":"6023353384","zip":"94043","city":"Mountain View","phone":"7043937192","state":"CA","country":"USA","inactive":false,"street_1":"571 McClure Fords","street_2":"Apt. 459","created_at":"2018-05-22T11:06:02.000-07:00","updated_at":"2018-05-22T11:06:02.000-07:00","county_name":"Santa Clara","work_address":true,"employee_count":81},"benefits_address":{"id":7757869432017410,"fax":"6023353384","zip":"94043","city":"Mountain View","phone":"7043937192","state":"CA","country":"USA","inactive":false,"street_1":"571 McClure Fords","street_2":"Apt. 459","created_at":"2018-05-22T11:06:02.000-07:00","updated_at":"2018-05-22T11:06:02.000-07:00","county_name":"Santa Clara","work_address":true,"employee_count":81},"number_of_eligible_ees":60,"number_of_ineligible_ees":11,"has_federal_cobra":true,"is_suspended":false,"panda_url":"http://manage.gusto-dev.com:3000/companies/7757616923585579","hippo_url":"http://localhost:4001/companies/7757616923585579","google_drive_folder_url":"No Google Drive folder set up"},"state_carriers":[{"id":11,"name":"United","state":"CA","key":"united_ca","url":"http://localhost:4001/national_carriers/9/state_carriers/11","carrier_enrollment_url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292/enrollments/485649/cal_choice_ca","forms":[950452]},{"id":3,"name":"Delta Dental","state":"CA","key":"delta_ca","url":"http://localhost:4001/national_carriers/15/state_carriers/3","carrier_enrollment_url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292/enrollments/485649/delta_ca","forms":[950453]},{"id":7,"name":"VSP","state":"CA","key":"vsp_ca","url":"http://localhost:4001/national_carriers/62/state_carriers/7","carrier_enrollment_url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292/enrollments/485649/vsp_ca","forms":[950454]}],"benefit_items":{"medical":{"current":{"id":1028647,"policy_id":85860,"benefit_type":"medical","subscriber_id":null,"processing_status":"not_started","start_date":null,"end_date":null,"enrollment_id":485649,"employee_id":7757869432016292,"dependent_ids":[35570],"state_carrier_id":11,"url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292/selections/1028647","estimated_start_date":"2019-05-31","estimated_total_premium":1072.79,"estimated_employee_premium":445.11,"estimated_dependents_premium":627.68,"ops_owner":"member_fulfillment"},"overlapping":[{"id":475436,"policy_id":85860,"benefit_type":"medical","subscriber_id":"88705326","processing_status":"processed","start_date":"2019-01-01","end_date":"2019-12-31","enrollment_id":347657,"employee_id":7757869432016292,"dependent_ids":[],"state_carrier_id":11,"url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292/subscriptions/475436"}],"previous":[]},"dental":{"current":{"id":1028648,"policy_id":85862,"benefit_type":"dental","subscriber_id":null,"processing_status":"not_started","start_date":null,"end_date":null,"enrollment_id":485649,"employee_id":7757869432016292,"dependent_ids":[35570],"state_carrier_id":3,"url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292/selections/1028648","estimated_start_date":"2019-05-31","estimated_total_premium":130.58,"estimated_employee_premium":64.13,"estimated_dependents_premium":66.45,"ops_owner":"member_fulfillment"},"overlapping":[{"id":475500,"policy_id":85862,"benefit_type":"dental","subscriber_id":"90349987","processing_status":"processed","start_date":"2019-01-01","end_date":"2019-12-31","enrollment_id":347657,"employee_id":7757869432016292,"dependent_ids":[],"state_carrier_id":3,"url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292/subscriptions/475500"}],"previous":[]},"vision":{"current":{"id":1028649,"policy_id":85863,"benefit_type":"vision","subscriber_id":null,"processing_status":"not_started","start_date":null,"end_date":null,"enrollment_id":485649,"employee_id":7757869432016292,"dependent_ids":[35570],"state_carrier_id":7,"url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292/selections/1028649","estimated_start_date":"2019-05-31","estimated_total_premium":16.12,"estimated_employee_premium":10.38,"estimated_dependents_premium":5.74,"ops_owner":"member_fulfillment"},"overlapping":[{"id":475530,"policy_id":85863,"benefit_type":"vision","subscriber_id":"71652644","processing_status":"processed","start_date":"2019-01-01","end_date":"2019-12-31","enrollment_id":347657,"employee_id":7757869432016292,"dependent_ids":[],"state_carrier_id":7,"url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292/subscriptions/475530"}],"previous":[]}},"policies":[{"id":85860,"name":"CalChoice Anthem Gold Select PPO C","benefit_type":"medical","group_number":"58000202","policy_number":null,"plan_id":18064,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":11,"url":"http://localhost:4001/companies/7757616923585579/policies/85860"},{"id":85861,"name":"CalChoice Kaiser Platinum Full HMO A","benefit_type":"medical","group_number":"96361069","policy_number":null,"plan_id":18088,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":11,"url":"http://localhost:4001/companies/7757616923585579/policies/85861"},{"id":85862,"name":"Delta Dental PPO Plus Premier Enhanced [VolkScience]","benefit_type":"dental","group_number":"96405913","policy_number":null,"plan_id":8967,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":3,"url":"http://localhost:4001/companies/7757616923585579/policies/85862"},{"id":85863,"name":"VSP Signature Plan [Volkscience]","benefit_type":"vision","group_number":"62972822","policy_number":null,"plan_id":8968,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":7,"url":"http://localhost:4001/companies/7757616923585579/policies/85863"}],"dependents":[{"id":35570,"first_name":"Arlinda","last_name":"Brakus","ssn":"123456789","birthday":"1980-12-04","gender":"male","dependent_type":"spouse","employee_id":7757869432016292,"url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292/dependents/35570"}],"forms":[{"id":950454,"name":"VSP Enrollment Form","signed_at":"2019-06-30T21:35:02.972-07:00","url":"http://localhost:4001/attachments/forms/950454"},{"id":950453,"name":"2017 Delta Change Form","signed_at":"2019-06-30T21:35:11.390-07:00","url":"http://localhost:4001/attachments/forms/950453"},{"id":950452,"name":"2019 CalChoice EE Change Form / QLE Form","signed_at":"2019-06-30T21:35:16.320-07:00","url":"http://localhost:4001/attachments/forms/950452"}],"answers":[],"benefits_url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292/benefits","enrollments_url":"http://localhost:4001/companies/7757616923585579/employees/7757869432016292/enrollments","alegeus":{"fsa":{"benefit_items":{"current":null,"overlapping":[],"previous":[]},"policies":[{"id":86321,"name":"Health FSA","benefit_type":"fsa","company_alegeus_id":314732886,"visible":true,"termination_policy":"last_day_of_employment","url":"http://localhost:4001/companies/7757616923585579/policies/86321"}]}}}';
		insert hiEventRec;

		test.startTest();
		List<Case> caseList = new List<Case>(
			[
				SELECT Id, Type, Carrier__c, OwnerId, Owner.Name, Status
				FROM Case
				WHERE Automation_Status__c NOT IN ('Failed', 'Completed') AND Type = 'NHE' AND Status NOT IN ('Solved', 'Closed', 'Resolved', 'Cancelled')
			]
		);
		System.assertEquals(testCarrier.id, caseList[0].Carrier__c);

		String reqUrl = URL.getSalesforceBaseUrl() + '/services/apexrest/MFAutomationService/Carrier/60?type=NHE&state=ca';
		RestRequest req = new RestRequest();
		req.requestUri = reqUrl;
		req.addParameter('type', 'NHE');
		req.addParameter('state', 'ca');
		req.httpMethod = 'GET';
		RestResponse res = new RestResponse();
		RestContext.request = req;
		RestContext.response = res;

		HIBotGetEnrollmentService.doGet();
		test.stopTest();
	}

	static testMethod void testTerminationData() {
		HI_Fulfillment_Event__c hiEventRec = new HI_Fulfillment_Event__c();
		hiEventRec.id__c = 'Test421';
		hiEventRec.Event_Type__c = 'employee_losing_eligibility';
		hiEventRec.Event_Info__c = '{"losing_benefits_date":"2017-07-27","losing_benefits_reason":"Termination","carrier_directory":"https://confluence.gustocorp.com/pages/viewpage.action?pageId=28803132","employee":{"id":7757869431795591,"first_name":"Eileen","last_name":"Koepp","middle_initial":"","status":"Active","ssn":"123456789","birthday":"1981-08-14","company_id":7757616923585579,"hired_at":"2017-07-10","employment_status":"full_time","home_address":{"id":7757727714014570,"street_1":"6198 Elaina Inlet","street_2":"Suite 639","city":"San Francisco","county_name":"San Francisco","state":"CA","zip":"94109","country":"USA","phone":null,"created_at":"2017-07-05T15:26:28.000-07:00","updated_at":"2017-07-05T15:26:28.000-07:00","fax":null,"inactive":false,"work_address":false},"work_address":{"id":1383002648546509,"street_1":"88464 Harmon Pine","street_2":"Suite 812","city":"San Francisco","county_name":"San Francisco","state":"CA","zip":"94107","country":"USA","phone":"7944174714","created_at":"2013-10-28T16:24:08.000-07:00","updated_at":"2016-05-25T08:12:58.000-07:00","fax":"3587335331","inactive":false,"work_address":true,"employee_count":61},"email":"tamia7757869449269353@uptonreynolds.com","gender":"male","panda_url":"http://manage.zenpayroll.dev:3000/companies/1370368242490000/employees/7757869431795591","hippo_url":"http://localhost:4001/companies/1370368242490000/employees/7757869431795591","payroll_type":"Exempt"},"company":{"id":7757616923585579,"name":"Homenick-Aufderhar","email":"hollie_haley7757869448810741@ernser.name","salesforce_account_id":null,"work_states":["CA"],"sic_code":"8999","mailing_address":{"id":1383002648546509,"street_1":"88464 Harmon Pine","street_2":"Suite 812","city":"San Francisco","county_name":"San Francisco","state":"CA","zip":"94107","country":"USA","phone":"7944174714","created_at":"2013-10-28T16:24:08.000-07:00","updated_at":"2016-05-25T08:12:58.000-07:00","fax":"3587335331","inactive":false,"work_address":true,"employee_count":61},"filing_address":{"id":1383002648546509,"street_1":"88464 Harmon Pine","street_2":"Suite 812","city":"San Francisco","county_name":"San Francisco","state":"CA","zip":"94107","country":"USA","phone":"7944174714","created_at":"2013-10-28T16:24:08.000-07:00","updated_at":"2016-05-25T08:12:58.000-07:00","fax":"3587335331","inactive":false,"work_address":true,"employee_count":61},"benefits_address":{"id":1383002648546509,"street_1":"88464 Harmon Pine","street_2":"Suite 812","city":"San Francisco","county_name":"San Francisco","state":"CA","zip":"94107","country":"USA","phone":"7944174714","created_at":"2013-10-28T16:24:08.000-07:00","updated_at":"2016-05-25T08:12:58.000-07:00","fax":"3587335331","inactive":false,"work_address":true,"employee_count":61},"number_of_eligible_ees":39,"number_of_ineligible_ees":2,"has_federal_cobra":true,"is_suspended":false,"panda_url":"http://manage.zenpayroll.dev:3000/companies/1370368242490000","hippo_url":"http://localhost:4001/companies/1370368242490000"},"state_carriers":[{"id":60,"name":"Guardian","state":"CA","key":"united_ca","url":"http://localhost:4001/national_carriers/24/state_carriers/22","forms":[]},{"id":2,"name":"Blue Shield of California","state":"CA","key":"blue_shield_ca","url":"http://localhost:4001/national_carriers/8/state_carriers/2","forms":[]}],"subscriptions":[{"id":103300,"policy_id":3043,"benefit_type":"dental","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":48910,"employee_id":7757869431795591,"dependent_ids":[],"state_carrier_id":60,"url":"http://localhost:4001/companies/1370368242490000/employees/7757869431795591/subscriptions/103300","total_premium":58.36},{"id":103301,"policy_id":3044,"benefit_type":"vision","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":48910,"employee_id":7757869431795591,"dependent_ids":[],"state_carrier_id":60,"url":"http://localhost:4001/companies/1370368242490000/employees/7757869431795591/subscriptions/103301","total_premium":13.44},{"id":103298,"policy_id":8401,"benefit_type":"medical","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":48910,"employee_id":7757869431795591,"dependent_ids":[],"state_carrier_id":60,"url":"http://localhost:4001/companies/1370368242490000/employees/7757869431795591/subscriptions/103298","total_premium":742.56}],"policies":[{"id":3043,"name":"DentalGuard Preferred [Lob.com]","benefit_type":"dental","group_number":"501254","policy_number":null,"plan_id":163,"visible":true,"termination_policy":null,"state_carrier_id":60,"url":"http://localhost:4001/companies/1370368242490000/policies/3043"},{"id":3044,"name":"VSP Signature Full Feature [Lob.com]","benefit_type":"vision","group_number":"501254","policy_number":null,"plan_id":164,"visible":true,"termination_policy":null,"state_carrier_id":60,"url":"http://localhost:4001/companies/1370368242490000/policies/3044"},{"id":8401,"name":"Platinum Full PPO 0/10 OffEx","benefit_type":"medical","group_number":"W0076882","policy_number":null,"plan_id":952,"visible":true,"termination_policy":null,"state_carrier_id":60,"url":"http://localhost:4001/companies/1370368242490000/policies/8401"}],"dependents":[],"forms":[],"tada":{"dca":{"subscriptions":[],"policies":[]},"fsa":{"subscriptions":[{"id":103302,"policy_id":26484,"benefit_type":"fsa","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":48910,"employee_id":7757869431795591,"employee_alegeus_id":218828899,"dependent_ids":[],"url":"http://localhost:4001/companies/1370368242490000/employees/7757869431795591/subscriptions/103302"}],"policies":[{"id":26484,"name":"Health FSA","benefit_type":"fsa","company_alegeus_id":964954019,"visible":true,"termination_policy":"last_day_of_employment","url":"http://localhost:4001/companies/1370368242490000/policies/26484","provider_key": "alegeus"}]},"hsa":{}},"subscriptions_url":"http://localhost:4001/companies/1370368242490000/employees/7757869431795591/subscriptions","dependents_url":"http://localhost:4001/companies/1370368242490000/employees/7757869431795591/dependents","commuter_benefit":{"id":3,"company_id":1408063107892611,"status":"processed","start_date":"2017-09-01","end_date":null,"upcoming":false,"active":true,"expired":false,"waiting_period":"first_of_month_following_hire","company_contribution_inputs":{"type":"fixed_amount","parking_contribution_amount":"0","transit_contribution_amount":"255"},"url":"https://hippo.gusto.com/companies/1408063107892611/commuter_benefits/3"},"commuter_employee_benefit":{"id":4,"employee_id":7757869431686263,"commuter_benefit_id":3,"status":"processed","start_date":"2017-09-01","transit_monthly_election":"255.0","transit_monthly_contribution":"255.0","transit_monthly_deduction":"0.0","parking_monthly_election":"0.0","parking_monthly_contribution":"0.0","parking_monthly_deduction":"0.0","url":"https://hippo.gusto.com/companies/1408063107892611/employees/7757869431686263/commuter_employee_benefits/4","commuter_benefit_url":"https://hippo.gusto.com/companies/1408063107892611/commuter_benefits/3"}}';
		hiEventRec.Employee_id__c = '7757869431795591';
		insert hiEventRec;

		test.startTest();
		List<Case> caseList = new List<Case>([SELECT Id, Type, Carrier__c, OwnerId, Owner.Name, Status FROM Case WHERE Automation_Status__c NOT IN ('Failed', 'Completed') AND Type = 'Termination']);

		String reqUrl = URL.getSalesforceBaseUrl() + '/services/apexrest/MFAutomationService/Carrier/60?type=Termination';
		RestRequest req = new RestRequest();
		req.requestUri = reqUrl;
		req.addParameter('type', 'Termination');
		req.httpMethod = 'GET';
		RestResponse res = new RestResponse();
		RestContext.request = req;
		RestContext.response = res;

		HIBotGetEnrollmentService.doGet();
		test.stopTest();
	}

	static testMethod void testTerminationGetCaseDetail() {
		HI_Fulfillment_Event__c hiEventRec = new HI_Fulfillment_Event__c();
		hiEventRec.id__c = 'Test421';
		hiEventRec.Event_Type__c = 'employee_losing_eligibility';
		hiEventRec.Event_Info__c = '{"losing_benefits_date":"2017-07-27","losing_benefits_reason":"Termination","carrier_directory":"https://confluence.gustocorp.com/pages/viewpage.action?pageId=28803132","employee":{"id":7757869431795591,"first_name":"Eileen","last_name":"Koepp","middle_initial":"","status":"Active","ssn":"123456789","birthday":"1981-08-14","company_id":7757616923585579,"hired_at":"2017-07-10","employment_status":"full_time","home_address":{"id":7757727714014570,"street_1":"6198 Elaina Inlet","street_2":"Suite 639","city":"San Francisco","county_name":"San Francisco","state":"CA","zip":"94109","country":"USA","phone":null,"created_at":"2017-07-05T15:26:28.000-07:00","updated_at":"2017-07-05T15:26:28.000-07:00","fax":null,"inactive":false,"work_address":false},"work_address":{"id":1383002648546509,"street_1":"88464 Harmon Pine","street_2":"Suite 812","city":"San Francisco","county_name":"San Francisco","state":"CA","zip":"94107","country":"USA","phone":"7944174714","created_at":"2013-10-28T16:24:08.000-07:00","updated_at":"2016-05-25T08:12:58.000-07:00","fax":"3587335331","inactive":false,"work_address":true,"employee_count":61},"email":"tamia7757869449269353@uptonreynolds.com","gender":"male","panda_url":"http://manage.zenpayroll.dev:3000/companies/1370368242490000/employees/7757869431795591","hippo_url":"http://localhost:4001/companies/1370368242490000/employees/7757869431795591","payroll_type":"Exempt"},"company":{"id":7757616923585579,"name":"Homenick-Aufderhar","email":"hollie_haley7757869448810741@ernser.name","salesforce_account_id":null,"work_states":["CA"],"sic_code":"8999","mailing_address":{"id":1383002648546509,"street_1":"88464 Harmon Pine","street_2":"Suite 812","city":"San Francisco","county_name":"San Francisco","state":"CA","zip":"94107","country":"USA","phone":"7944174714","created_at":"2013-10-28T16:24:08.000-07:00","updated_at":"2016-05-25T08:12:58.000-07:00","fax":"3587335331","inactive":false,"work_address":true,"employee_count":61},"filing_address":{"id":1383002648546509,"street_1":"88464 Harmon Pine","street_2":"Suite 812","city":"San Francisco","county_name":"San Francisco","state":"CA","zip":"94107","country":"USA","phone":"7944174714","created_at":"2013-10-28T16:24:08.000-07:00","updated_at":"2016-05-25T08:12:58.000-07:00","fax":"3587335331","inactive":false,"work_address":true,"employee_count":61},"benefits_address":{"id":1383002648546509,"street_1":"88464 Harmon Pine","street_2":"Suite 812","city":"San Francisco","county_name":"San Francisco","state":"CA","zip":"94107","country":"USA","phone":"7944174714","created_at":"2013-10-28T16:24:08.000-07:00","updated_at":"2016-05-25T08:12:58.000-07:00","fax":"3587335331","inactive":false,"work_address":true,"employee_count":61},"number_of_eligible_ees":39,"number_of_ineligible_ees":2,"has_federal_cobra":true,"is_suspended":false,"panda_url":"http://manage.zenpayroll.dev:3000/companies/1370368242490000","hippo_url":"http://localhost:4001/companies/1370368242490000"},"state_carriers":[{"id":60,"name":"Guardian","state":"CA","key":"united_ca","url":"http://localhost:4001/national_carriers/24/state_carriers/22","forms":[]},{"id":2,"name":"Blue Shield of California","state":"CA","key":"blue_shield_ca","url":"http://localhost:4001/national_carriers/8/state_carriers/2","forms":[]}],"subscriptions":[{"id":103300,"policy_id":3043,"benefit_type":"dental","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":48910,"employee_id":7757869431795591,"dependent_ids":[],"state_carrier_id":60,"url":"http://localhost:4001/companies/1370368242490000/employees/7757869431795591/subscriptions/103300","total_premium":58.36},{"id":103301,"policy_id":3044,"benefit_type":"vision","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":48910,"employee_id":7757869431795591,"dependent_ids":[],"state_carrier_id":60,"url":"http://localhost:4001/companies/1370368242490000/employees/7757869431795591/subscriptions/103301","total_premium":13.44},{"id":103298,"policy_id":8401,"benefit_type":"medical","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":48910,"employee_id":7757869431795591,"dependent_ids":[],"state_carrier_id":60,"url":"http://localhost:4001/companies/1370368242490000/employees/7757869431795591/subscriptions/103298","total_premium":742.56}],"policies":[{"id":3043,"name":"DentalGuard Preferred [Lob.com]","benefit_type":"dental","group_number":"501254","policy_number":null,"plan_id":163,"visible":true,"termination_policy":null,"state_carrier_id":60,"url":"http://localhost:4001/companies/1370368242490000/policies/3043"},{"id":3044,"name":"VSP Signature Full Feature [Lob.com]","benefit_type":"vision","group_number":"501254","policy_number":null,"plan_id":164,"visible":true,"termination_policy":null,"state_carrier_id":60,"url":"http://localhost:4001/companies/1370368242490000/policies/3044"},{"id":8401,"name":"Platinum Full PPO 0/10 OffEx","benefit_type":"medical","group_number":"W0076882","policy_number":null,"plan_id":952,"visible":true,"termination_policy":null,"state_carrier_id":60,"url":"http://localhost:4001/companies/1370368242490000/policies/8401"}],"dependents":[],"forms":[],"tada":{"dca":{},"fsa":{"subscriptions":[{"id":103302,"policy_id":26484,"benefit_type":"fsa","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":48910,"employee_id":7757869431795591,"employee_alegeus_id":218828899,"dependent_ids":[],"url":"http://localhost:4001/companies/1370368242490000/employees/7757869431795591/subscriptions/103302"}],"policies":[{"id":26484,"name":"Health FSA","benefit_type":"fsa","company_alegeus_id":964954019,"visible":true,"termination_policy":"last_day_of_employment","url":"http://localhost:4001/companies/1370368242490000/policies/26484","provider_key": "alegeus"}]},"hsa":{}},"subscriptions_url":"http://localhost:4001/companies/1370368242490000/employees/7757869431795591/subscriptions","dependents_url":"http://localhost:4001/companies/1370368242490000/employees/7757869431795591/dependents","commuter_benefit":{"id":3,"company_id":1408063107892611,"status":"processed","start_date":"2017-09-01","end_date":null,"upcoming":false,"active":true,"expired":false,"waiting_period":"first_of_month_following_hire","company_contribution_inputs":{"type":"fixed_amount","parking_contribution_amount":"0","transit_contribution_amount":"255"},"url":"https://hippo.gusto.com/companies/1408063107892611/commuter_benefits/3","provider_key": "alegeus"},"commuter_employee_benefit":{"id":4,"employee_id":7757869431686263,"commuter_benefit_id":3,"status":"processed","start_date":"2017-09-01","transit_monthly_election":"255.0","transit_monthly_contribution":"255.0","transit_monthly_deduction":"0.0","parking_monthly_election":"0.0","parking_monthly_contribution":"0.0","parking_monthly_deduction":"0.0","url":"https://hippo.gusto.com/companies/1408063107892611/employees/7757869431686263/commuter_employee_benefits/4","commuter_benefit_url":"https://hippo.gusto.com/companies/1408063107892611/commuter_benefits/3"}}';
		hiEventRec.Employee_id__c = '7757869431795591';
        hiEventRec.Company_id__c = '7757616923585579';
		insert hiEventRec;

		test.startTest();
		List<Case> caseList = new List<Case>([SELECT Id, Type, Carrier__c, OwnerId, Owner.Name, Status FROM Case WHERE Automation_Status__c NOT IN ('Failed', 'Completed') AND Type = 'Termination']);

		String reqUrl = URL.getSalesforceBaseUrl() + '/services/apexrest/MFAutomationService/Carrier/60?type=Termination';
		RestRequest req = new RestRequest();
		req.requestUri = reqUrl;
		req.addParameter('type', 'Termination');
		req.addParameter('caseId', '' + caseList[0].id);
		req.httpMethod = 'GET';
		RestResponse res = new RestResponse();
		RestContext.request = req;
		RestContext.response = res;

		HIBotGetEnrollmentService.doGet();
		test.stopTest();
	}

	static testMethod void testMemberUpdateGetCaseDetail() {
		HIFulfillmentEventTriggerHelper.queue = true;
		HI_Fulfillment_Event__c hiEventRec = new HI_Fulfillment_Event__c();
		hiEventRec.id__c = 'Test421';
		hiEventRec.Event_Type__c = 'employee_update';
		hiEventRec.Event_Info__c = '{"benefit_items": [{"state_carrier_id": 60,"id": 21225,"policy_id": 6135,"benefit_type": "life","start_date": "2016-09-01","end_date": "2017-08-31","employee_id": 7757869431795591}],"updates": [	{"type": "home_address","previous": {"home_address": {"id": null,"fax": null,"zip": null,"city": null,"phone": null,"state": null,"country": null,"inactive": false,"street_1": null,"street_2": null,"created_at": null,"updated_at": null,"county_name": null,"work_address": false,"location_code": null,"addressable_id": null,"addressable_type": null,"psd_code": null,"latitude": null,"longitude": null,"county_code": null,"municipality_code": null,"municipality_name": null,"psd_rate": null,"school_code": null,"school_name": null,"transit_district_code": null,"transit_district_name": null,"geocode_state": null}},"current": {"home_address": {"id": 7757869450060448,"fax": null,"zip": "34609","city": "Spring Hill","phone": null,"state": "FL","country": "USA","inactive": false,"street_1": "3588 Swordfish Ln","street_2": "","created_at": "2020-01-02T05:24:43.000-08:00","updated_at": "2020-01-02T05:24:43.000-08:00","county_name": "Hernando","work_address": false}}},{"type": "first_name","previous": {"first_name": "Harry"},"current": {"first_name": "Paul"}}],"updated_at": "2017-08-03","employee": {"id": 7757869431795591,"first_name": "Garea","last_name": "Law","middle_initial": "","status": "Active","ssn": "123454912","birthday": "1985-01-27","company_id": 7757616923585579,"hired_at": "2016-08-15","employment_status": "full_time","home_address": {"id": 7757727713544802,"street_1": "730 DuBuque Forest","street_2": "Suite 998","city": "San Francisco","county_name": "San Francisco","state": "CA","zip": "94108","country": "USA","phone": null,"created_at": "2016-08-16T13:52:18.000-07:00","updated_at": "2017-07-25T18:09:34.000-07:00","fax": null,"inactive": false,"work_address": false},"work_address": {"id": 7757727713727152,"street_1": "714 Junior Roads","street_2": "Suite 395","city": "San Francisco","county_name": "San Francisco","state": "CA","zip": "94105","country": "USA","phone": "2968875378","created_at": "2017-01-05T14:56:00.000-08:00","updated_at": "2017-01-11T14:29:19.000-08:00","fax": "5622226496","inactive": false,"work_address": true,"employee_count": 19},"email": "katlyn7757869448929327@lind.co","gender": "male","panda_url": "http://manage.zenpayroll.dev:3000/companies/7757616923580839/employees/7757869431528940","hippo_url": "http://localhost:4001/companies/7757616923580839/employees/7757869431528940"},"company": {"id": 7757616923585579,"name": "Wisozk-Hermiston","email": "deanna7757869448866931@wisozk.org","salesforce_account_id": null,"work_states": ["CA"],"sic_code": "4215","mailing_address": {"id": 7757727713727152,"street_1": "714 Junior Roads","street_2": "Suite 395","city": "San Francisco","county_name": "San Francisco","state": "CA","zip": "94105","country": "USA","phone": "2968875378","created_at": "2017-01-05T14:56:00.000-08:00","updated_at": "2017-01-11T14:29:19.000-08:00","fax": "5622226496","inactive": false,"work_address": true,"employee_count": 19},"filing_address": {"id": 7757727713727152,"street_1": "714 Junior Roads","street_2": "Suite 395","city": "San Francisco","county_name": "San Francisco","state": "CA","zip": "94105","country": "USA","phone": "2968875378","created_at": "2017-01-05T14:56:00.000-08:00","updated_at": "2017-01-11T14:29:19.000-08:00","fax": "5622226496","inactive": false,"work_address": true,"employee_count": 19},"benefits_address": {"id": 7757727713727152,"street_1": "714 Junior Roads","street_2": "Suite 395","city": "San Francisco","county_name": "San Francisco","state": "CA","zip": "94105","country": "USA","phone": "2968875378","created_at": "2017-01-05T14:56:00.000-08:00","updated_at": "2017-01-11T14:29:19.000-08:00","fax": "5622226496","inactive": false,"work_address": true,"employee_count": 19},"number_of_eligible_ees": 8,"number_of_ineligible_ees": 11,"has_federal_cobra": null,"is_suspended": false,"panda_url": "http://manage.zenpayroll.dev:3000/companies/7757616923580839","hippo_url": "http://localhost:4001/companies/7757616923580839"},"state_carriers": [{"id": 60,"name": "United","state": "CA","key": "united_ca","url": "http://localhost:4001/national_carriers/24/state_carriers/22"}],"subscriptions": [{"id": 58497,"policy_id": 7176,"benefit_type": "medical","subscriber_id": "40333004","start_date": "2017-01-31","end_date": "2017-10-31","processed": true,"enrollment_id": 28233,"employee_id": 7757869431795591,"dependent_ids": [4644,9846],"state_carrier_id": 60,"url": "http://localhost:4001/companies/7757616923580839/employees/7757869431528940/subscriptions/58497"}],"policies": [{"id": 7179,"name": "Guardian EM Vision 12","benefit_type": "vision","group_number": "G-00532246","policy_number": null,"plan_id": 1814,"visible": true,"termination_policy": "last_day_of_month_on_or_after_termination","state_carrier_id": 60,"url": "http://localhost:4001/companies/7757616923580839/policies/7179"}],"subscriptions_url": "http://localhost:4001/companies/7757616923580839/employees/7757869431528940/subscriptions","sent_at": "2020-01-03T18:09:34.000-07:00"}';
		hiEventRec.Employee_id__c = '7757869431795591';
		hiEventRec.Company_id__c = '7757616923585579';
		insert hiEventRec;

		test.startTest();
		List<Case> caseList = new List<Case>(
			[SELECT Id, Type, Carrier__c, OwnerId, Owner.Name, Status FROM Case WHERE Automation_Status__c NOT IN ('Failed', 'Completed') AND Type = 'Member Updates']
		);
		System.assertEquals(1, caseList.size());

		String reqUrl = URL.getSalesforceBaseUrl() + '/services/apexrest/MFAutomationService/Carrier/60?type=Member Updates';
		RestRequest req = new RestRequest();
		req.requestUri = reqUrl;
		req.addParameter('type', 'Member Updates');
		req.httpMethod = 'GET';
		RestResponse res = new RestResponse();
		RestContext.request = req;
		RestContext.response = res;

		HIBotGetEnrollmentService.doGet();
		test.stopTest();
	}
}