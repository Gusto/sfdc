/**
  Author:        Robin Grover
  Company:       Gusto
  Description:   This is a test class for HIFulfillmentEventEnrollment

  History
  7/11/2017    Robin Grover     Initial Implementation
  **/
@isTest
private class HIFulfillmentEventEnrollmentTest {
	@testSetup
	static void setup() {
		Utils.skipTrigger(true);
		EncryptionUtils.generateKey('Master');
		Account objAccount = new TestDataFactory.AccountBuilder().setRecordTypeId('Company').setZPCompanyID('7757616923599114').setName('Gusto Test Account').build();
		insert objAccount;

		State__c objState = new TestDataFactory.StateBuilder().setName('California').setAbbreviation('CA').build();
		insert objState;

		List<Carrier__c> list_Carriers = new List<Carrier__c>();
		list_Carriers.add(new TestDataFactory.CarrierBuilder().setName('Principal').setUniqueName('Principal').setState('CA').setCarrierId('48').setKey('principal_ca').setId('24').build());
		list_Carriers.add(new TestDataFactory.CarrierBuilder().setName('Kaiser Permanente').setUniqueName('Kaiser Permanente').setState('CA').setCarrierId('36').setKey('beam_ca').setId('5').build());
		insert list_Carriers;

		Utils.skipTrigger(false);
	}

	/**
	 * @Author      : Bhagat singh
	 * @Description : Process enrollment_ready_for_processing Event : Postive Case
	 **/
	@isTest
	static void insertingHIFulfillEventRecord() {
		Test.startTest();
		HIFulfillmentEventTriggerHelper.queue = true;
		CaseTriggerHelper.skipTrigger = true;
		HI_Fulfillment_Event__c objHiEvent = new TestDataFactory.HIFulfillmentEventBuilder()
			.setId('Test321')
			.setEventType('enrollment_ready_for_processing')
			.setEventInfo(
				'{"error_message":"test error","enrollment":{"id":47431,"employee_id":7757869431613363,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/enrollments/47431"},"recent_qles":[],"carrier_directory":"https://confluence.gustocorp.com/pages/viewpage.action?pageId=28803132","employee":{"id":7757869431613363,"first_name":"Vincent","last_name":"Smitham","middle_initial":"M","status":"Active","ssn":"123456789","birthday":"1985-03-12","company_id":7757616923599114,"hired_at":"2014-05-12","employment_status":"full_time","home_address":{"id":7757727713689401,"street_1":"4349 Bradley Circles","street_2":"Suite 826","city":"Los Angeles","county_name":"Los Angeles","state":"CA","zip":"90027","country":"USA","phone":null,"created_at":"2016-12-14T14:36:45.000-08:00","updated_at":"2016-12-14T14:36:45.000-08:00","fax":null,"inactive":false,"work_address":false},"work_address":{"id":7757727713687976,"street_1":"427 O\'Reilly Ramp","street_2":"Suite 475","city":"Los Angeles","county_name":"Los Angeles","state":"CA","zip":"90029","country":"USA","phone":"8899664872","created_at":"2016-12-13T17:35:24.000-08:00","updated_at":"2016-12-13T17:35:24.000-08:00","fax":null,"inactive":false,"work_address":true,"employee_count":6},"email":"schuyler.muller7757869449033705@turcottefisher.info","gender":"male","panda_url":"http://manage.zenpayroll.dev:3000/companies/7757616923599114/employees/7757869431613363","hippo_url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363"},"company":{"id":7757616923599114,"name":"Kihn, Cole and Turner","email":"justyn_dickens7757869449032810@bednar.com","salesforce_account_id":null,"work_states":["CA"],"sic_code":"6794","mailing_address":{"id":7757727713687976,"street_1":"427 O\'Reilly Ramp","street_2":"Suite 475","city":"Los Angeles","county_name":"Los Angeles","state":"CA","zip":"90029","country":"USA","phone":"8899664872","created_at":"2016-12-13T17:35:24.000-08:00","updated_at":"2016-12-13T17:35:24.000-08:00","fax":null,"inactive":false,"work_address":true,"employee_count":6},"filing_address":{"id":7757727713687976,"street_1":"427 O\'Reilly Ramp","street_2":"Suite 475","city":"Los Angeles","county_name":"Los Angeles","state":"CA","zip":"90029","country":"USA","phone":"8899664872","created_at":"2016-12-13T17:35:24.000-08:00","updated_at":"2016-12-13T17:35:24.000-08:00","fax":null,"inactive":false,"work_address":true,"employee_count":6},"benefits_address":{"id":7757727713687976,"street_1":"427 O\'Reilly Ramp","street_2":"Suite 475","city":"Los Angeles","county_name":"Los Angeles","state":"CA","zip":"90029","country":"USA","phone":"8899664872","created_at":"2016-12-13T17:35:24.000-08:00","updated_at":"2016-12-13T17:35:24.000-08:00","fax":null,"inactive":false,"work_address":true,"employee_count":6},"number_of_eligible_ees":6,"number_of_ineligible_ees":0,"has_federal_cobra":null,"is_suspended":false,"panda_url":"http://manage.zenpayroll.dev:3000/companies/7757616923599114","hippo_url":"http://localhost:4001/companies/7757616923599114"},"state_carriers":[{"id":24,"name":"Principal","state":"CA","key":"principal_ca","url":"http://localhost:4001/national_carriers/48/state_carriers/24","carrier_enrollment_url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/enrollments/47431/principal_ca","forms":[]},{"id":5,"name":"Kaiser Permanente","state":"CA","key":"kaiser_ca","url":"http://localhost:4001/national_carriers/36/state_carriers/5","carrier_enrollment_url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/enrollments/47431/kaiser_ca"}],"benefit_items":{"dental":{"current":null,"overlapping":[{"id":53794,"policy_id":15619,"benefit_type":"dental","subscriber_id":"22270388","start_date":"2017-03-01","end_date":"2018-02-28","processed":true,"enrollment_id":25666,"employee_id":7757869431613363,"dependent_ids":[],"state_carrier_id":24,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/53794"}],"previous":[]},"medical":{"current":{"id":98828,"policy_id":15841,"benefit_type":"medical","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":47431,"employee_id":7757869431613363,"dependent_ids":[16918],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/98828","estimated_start_date":"2017-05-26","estimated_total_premium":763.9,"estimated_employee_premium":375.63,"estimated_dependents_premium":388.27,"ops_owner":"member_fulfillment"},"overlapping":[{"id":53793,"policy_id":15842,"benefit_type":"medical","subscriber_id":"61306767","start_date":"2017-03-01","end_date":"2018-02-28","processed":true,"enrollment_id":25666,"employee_id":7757869431613363,"dependent_ids":[],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/53793"}],"previous":[]},"long_term_disability":{"current":{"id":98829,"policy_id":15841,"benefit_type":"long_term_disability","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":47431,"employee_id":7757869431613363,"dependent_ids":[16918],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/98828","estimated_start_date":"2017-05-26","estimated_total_premium":763.9,"estimated_employee_premium":375.63,"estimated_dependents_premium":388.27,"ops_owner":"member_fulfillment"},"overlapping":[{"id":53794,"policy_id":15842,"benefit_type":"long_term_disability","subscriber_id":"61306767","start_date":"2017-03-01","end_date":"2018-02-28","processed":true,"enrollment_id":25666,"employee_id":7757869431613363,"dependent_ids":[],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/53793"}],"previous":[]},"short_term_disability":{"current":{"id":98830,"policy_id":15841,"benefit_type":"short_term_disability","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":47431,"employee_id":7757869431613363,"dependent_ids":[16918],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/98828","estimated_start_date":"2017-05-26","estimated_total_premium":763.9,"estimated_employee_premium":375.63,"estimated_dependents_premium":388.27,"ops_owner":"member_fulfillment"},"overlapping":[{"id":53795,"policy_id":15842,"benefit_type":"short_term_disability","subscriber_id":"61306767","start_date":"2017-03-01","end_date":"2018-02-28","processed":true,"enrollment_id":25666,"employee_id":7757869431613363,"dependent_ids":[],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/53793"}],"previous":[]},"life":{"current":{"id":98831,"policy_id":15841,"benefit_type":"life","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":47431,"employee_id":7757869431613363,"dependent_ids":[16918],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/98828","estimated_start_date":"2017-05-26","estimated_total_premium":763.9,"estimated_employee_premium":375.63,"estimated_dependents_premium":388.27,"ops_owner":"member_fulfillment"},"overlapping":[{"id":53796,"policy_id":15842,"benefit_type":"life","subscriber_id":"61306767","start_date":"2017-03-01","end_date":"2018-02-28","processed":true,"enrollment_id":25666,"employee_id":7757869431613363,"dependent_ids":[],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/53793"}],"previous":[]},"vision":{"current":{"id":98829,"policy_id":15634,"benefit_type":"vision","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":47431,"employee_id":7757869431613363,"dependent_ids":[16918],"state_carrier_id":24,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/98829","estimated_start_date":"2017-05-26","estimated_total_premium":19.51,"estimated_employee_premium":9.68,"estimated_dependents_premium":9.83,"ops_owner":"member_fulfillment"},"overlapping":[],"previous":[]}},"policies":[{"id":15619,"name":"Principal Dental Plan 4","benefit_type":"dental","group_number":"1073605-10001","policy_number":null,"plan_id":2224,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":24,"url":"http://localhost:4001/companies/7757616923599114/policies/15619"},{"id":15631,"name":"Silver 70 HMO 1000/50 + Child Dental Alt","benefit_type":"medical","group_number":"344089","policy_number":null,"plan_id":2419,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/policies/15631"},{"id":15634,"name":"Principal Vision Plan 2","benefit_type":"vision","group_number":"","policy_number":null,"plan_id":1975,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":24,"url":"http://localhost:4001/companies/7757616923599114/policies/15634"},{"id":15841,"name":"Platinum 90 HMO 0/10 + Child Dental Alt","benefit_type":"medical","group_number":"","policy_number":null,"plan_id":2413,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/policies/15841"},{"id":15842,"name":"Gold 80 HMO 0/30 w/ Child Dental, Acu","benefit_type":"medical","group_number":"","policy_number":null,"plan_id":2410,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/policies/15842"}],"dependents":[{"id":16918,"first_name":"Doug","last_name":"Wintheiser","ssn":"123456789","birthday":"1983-07-03","gender":"female","dependent_type":"spouse","employee_id":7757869431613363,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/dependents/16918"}],"forms":[{"id":88268,"name":"2017 Kaiser CA Employee Change Form","url":"http://localhost:4001/attachments/forms/88268","carrier_id":5,"state_carrier_id":5}],"answers":[],"alegeus":{"fsa":{"benefit_items":{"current":{"id":103302,"policy_id":26484,"benefit_type":"fsa","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":48910,"employee_id":7757869431795591,"employee_alegeus_id":218828899,"dependent_ids":[],"url":"http://localhost:4001/companies/1370368242490000/employees/7757869431795591/subscriptions/103302","estimated_start_date":"2017-08-01","ops_owner":"member_fulfillment"},"overlapping":[],"previous":[]},"policies":[{"id":26484,"name":"Health FSA","benefit_type":"fsa","company_alegeus_id":964954019,"visible":true,"termination_policy":"last_day_of_employment","url":"http://localhost:4001/companies/1370368242490000/policies/26484"}]}},"benefits_url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions","enrollments_url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/enrollments"}'
			)
			.build();
		insert objHiEvent;

		Test.stopTest();

		List<Case> list_Cases = [SELECT ID, AccountId, Type, RecordType.Name, Account.ZP_Company_ID__c FROM Case LIMIT 1];
		System.assertEquals(list_Cases[0].RecordType.Name, 'MF NHE', 'Case created with Record Type as MF NHE.');
		System.assertEquals(list_Cases[0].Type, 'NHE', 'Case created with Type as MF NHE.');
		System.assertEquals(list_Cases[0].Account.ZP_Company_ID__c, '7757616923599114', 'Case Associated with company id as 7757616923599114.');
	}

	/**
	 * @Author      : Bhagat singh
	 * @Description : Process enrollment_ready_for_processing Event : Negative Case - HI Company Id missing
	 **/
	@isTest
	static void validateCompanyId() {
		Test.startTest();
		HIFulfillmentEventTriggerHelper.queue = true;
		HI_Fulfillment_Event__c objHiEvent = new TestDataFactory.HIFulfillmentEventBuilder()
			.setId('Test321')
			.setEventType('enrollment_ready_for_processing')
			.setEventInfo(
				'{"error_message":"test error","enrollment":{"id":47431,"employee_id":7757869431613363,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/enrollments/47431"},"recent_qles":[],"carrier_directory":"https://confluence.gustocorp.com/pages/viewpage.action?pageId=28803132","employee":{"id":7757869431613363,"first_name":"Vincent","last_name":"Smitham","middle_initial":"M","status":"Active","ssn":"123456789","birthday":"1985-03-12","company_id":7757616923599114,"hired_at":"2014-05-12","employment_status":"full_time","home_address":{"id":7757727713689401,"street_1":"4349 Bradley Circles","street_2":"Suite 826","city":"Los Angeles","county_name":"Los Angeles","state":"CA","zip":"90027","country":"USA","phone":null,"created_at":"2016-12-14T14:36:45.000-08:00","updated_at":"2016-12-14T14:36:45.000-08:00","fax":null,"inactive":false,"work_address":false},"work_address":{"id":7757727713687976,"street_1":"427 O\'Reilly Ramp","street_2":"Suite 475","city":"Los Angeles","county_name":"Los Angeles","state":"CA","zip":"90029","country":"USA","phone":"8899664872","created_at":"2016-12-13T17:35:24.000-08:00","updated_at":"2016-12-13T17:35:24.000-08:00","fax":null,"inactive":false,"work_address":true,"employee_count":6},"email":"schuyler.muller7757869449033705@turcottefisher.info","gender":"male","panda_url":"http://manage.zenpayroll.dev:3000/companies/7757616923599114/employees/7757869431613363","hippo_url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363"},"company":{"name":"Kihn, Cole and Turner","email":"justyn_dickens7757869449032810@bednar.com","salesforce_account_id":null,"work_states":["CA"],"sic_code":"6794","mailing_address":{"id":7757727713687976,"street_1":"427 O\'Reilly Ramp","street_2":"Suite 475","city":"Los Angeles","county_name":"Los Angeles","state":"CA","zip":"90029","country":"USA","phone":"8899664872","created_at":"2016-12-13T17:35:24.000-08:00","updated_at":"2016-12-13T17:35:24.000-08:00","fax":null,"inactive":false,"work_address":true,"employee_count":6},"filing_address":{"id":7757727713687976,"street_1":"427 O\'Reilly Ramp","street_2":"Suite 475","city":"Los Angeles","county_name":"Los Angeles","state":"CA","zip":"90029","country":"USA","phone":"8899664872","created_at":"2016-12-13T17:35:24.000-08:00","updated_at":"2016-12-13T17:35:24.000-08:00","fax":null,"inactive":false,"work_address":true,"employee_count":6},"benefits_address":{"id":7757727713687976,"street_1":"427 O\'Reilly Ramp","street_2":"Suite 475","city":"Los Angeles","county_name":"Los Angeles","state":"CA","zip":"90029","country":"USA","phone":"8899664872","created_at":"2016-12-13T17:35:24.000-08:00","updated_at":"2016-12-13T17:35:24.000-08:00","fax":null,"inactive":false,"work_address":true,"employee_count":6},"number_of_eligible_ees":6,"number_of_ineligible_ees":0,"has_federal_cobra":null,"is_suspended":false,"panda_url":"http://manage.zenpayroll.dev:3000/companies/7757616923599114","hippo_url":"http://localhost:4001/companies/7757616923599114"},"state_carriers":[{"id":24,"name":"Principal","state":"CA","key":"principal_ca","url":"http://localhost:4001/national_carriers/48/state_carriers/24","carrier_enrollment_url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/enrollments/47431/principal_ca","forms":[]},{"id":5,"name":"Kaiser Permanente","state":"CA","key":"kaiser_ca","url":"http://localhost:4001/national_carriers/36/state_carriers/5","carrier_enrollment_url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/enrollments/47431/kaiser_ca"}],"benefit_items":{"dental":{"current":null,"overlapping":[{"id":53794,"policy_id":15619,"benefit_type":"dental","subscriber_id":"22270388","start_date":"2017-03-01","end_date":"2018-02-28","processed":true,"enrollment_id":25666,"employee_id":7757869431613363,"dependent_ids":[],"state_carrier_id":24,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/53794"}],"previous":[]},"medical":{"current":{"id":98828,"policy_id":15841,"benefit_type":"medical","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":47431,"employee_id":7757869431613363,"dependent_ids":[16918],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/98828","estimated_start_date":"2017-05-26","estimated_total_premium":763.9,"estimated_employee_premium":375.63,"estimated_dependents_premium":388.27,"ops_owner":"member_fulfillment"},"overlapping":[{"id":53793,"policy_id":15842,"benefit_type":"medical","subscriber_id":"61306767","start_date":"2017-03-01","end_date":"2018-02-28","processed":true,"enrollment_id":25666,"employee_id":7757869431613363,"dependent_ids":[],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/53793"}],"previous":[]},"long_term_disability":{"current":{"id":98829,"policy_id":15841,"benefit_type":"long_term_disability","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":47431,"employee_id":7757869431613363,"dependent_ids":[16918],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/98828","estimated_start_date":"2017-05-26","estimated_total_premium":763.9,"estimated_employee_premium":375.63,"estimated_dependents_premium":388.27,"ops_owner":"member_fulfillment"},"overlapping":[{"id":53794,"policy_id":15842,"benefit_type":"long_term_disability","subscriber_id":"61306767","start_date":"2017-03-01","end_date":"2018-02-28","processed":true,"enrollment_id":25666,"employee_id":7757869431613363,"dependent_ids":[],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/53793"}],"previous":[]},"short_term_disability":{"current":{"id":98830,"policy_id":15841,"benefit_type":"short_term_disability","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":47431,"employee_id":7757869431613363,"dependent_ids":[16918],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/98828","estimated_start_date":"2017-05-26","estimated_total_premium":763.9,"estimated_employee_premium":375.63,"estimated_dependents_premium":388.27,"ops_owner":"member_fulfillment"},"overlapping":[{"id":53795,"policy_id":15842,"benefit_type":"short_term_disability","subscriber_id":"61306767","start_date":"2017-03-01","end_date":"2018-02-28","processed":true,"enrollment_id":25666,"employee_id":7757869431613363,"dependent_ids":[],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/53793"}],"previous":[]},"life":{"current":{"id":98831,"policy_id":15841,"benefit_type":"life","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":47431,"employee_id":7757869431613363,"dependent_ids":[16918],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/98828","estimated_start_date":"2017-05-26","estimated_total_premium":763.9,"estimated_employee_premium":375.63,"estimated_dependents_premium":388.27,"ops_owner":"member_fulfillment"},"overlapping":[{"id":53796,"policy_id":15842,"benefit_type":"life","subscriber_id":"61306767","start_date":"2017-03-01","end_date":"2018-02-28","processed":true,"enrollment_id":25666,"employee_id":7757869431613363,"dependent_ids":[],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/53793"}],"previous":[]},"vision":{"current":{"id":98829,"policy_id":15634,"benefit_type":"vision","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":47431,"employee_id":7757869431613363,"dependent_ids":[16918],"state_carrier_id":24,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/98829","estimated_start_date":"2017-05-26","estimated_total_premium":19.51,"estimated_employee_premium":9.68,"estimated_dependents_premium":9.83,"ops_owner":"member_fulfillment"},"overlapping":[],"previous":[]}},"policies":[{"id":15619,"name":"Principal Dental Plan 4","benefit_type":"dental","group_number":"1073605-10001","policy_number":null,"plan_id":2224,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":24,"url":"http://localhost:4001/companies/7757616923599114/policies/15619"},{"id":15631,"name":"Silver 70 HMO 1000/50 + Child Dental Alt","benefit_type":"medical","group_number":"344089","policy_number":null,"plan_id":2419,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/policies/15631"},{"id":15634,"name":"Principal Vision Plan 2","benefit_type":"vision","group_number":"","policy_number":null,"plan_id":1975,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":24,"url":"http://localhost:4001/companies/7757616923599114/policies/15634"},{"id":15841,"name":"Platinum 90 HMO 0/10 + Child Dental Alt","benefit_type":"medical","group_number":"","policy_number":null,"plan_id":2413,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/policies/15841"},{"id":15842,"name":"Gold 80 HMO 0/30 w/ Child Dental, Acu","benefit_type":"medical","group_number":"","policy_number":null,"plan_id":2410,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/policies/15842"}],"dependents":[{"id":16918,"first_name":"Doug","last_name":"Wintheiser","ssn":"123456789","birthday":"1983-07-03","gender":"female","dependent_type":"spouse","employee_id":7757869431613363,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/dependents/16918"}],"forms":[{"id":88268,"name":"2017 Kaiser CA Employee Change Form","url":"http://localhost:4001/attachments/forms/88268","carrier_id":5,"state_carrier_id":5}],"answers":[],"alegeus":{"fsa":{"benefit_items":{"current":{"id":103302,"policy_id":26484,"benefit_type":"fsa","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":48910,"employee_id":7757869431795591,"employee_alegeus_id":218828899,"dependent_ids":[],"url":"http://localhost:4001/companies/1370368242490000/employees/7757869431795591/subscriptions/103302","estimated_start_date":"2017-08-01","ops_owner":"member_fulfillment"},"overlapping":[],"previous":[]},"policies":[{"id":26484,"name":"Health FSA","benefit_type":"fsa","company_alegeus_id":964954019,"visible":true,"termination_policy":"last_day_of_employment","url":"http://localhost:4001/companies/1370368242490000/policies/26484"}]}},"benefits_url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions","enrollments_url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/enrollments"}'
			)
			.build();
		insert objHiEvent;

		Test.stopTest();

		List<HI_Fulfillment_Event__c> list_HIFulfillmentEvents = [SELECT Message__c, Processing_State__c FROM HI_Fulfillment_Event__c WHERE Id = :objHiEvent.Id];
		System.assertEquals(list_HIFulfillmentEvents[0].Processing_State__c, IntegrationUtils.ERROR_STATE);
		System.assertEquals(list_HIFulfillmentEvents[0].Message__c, 'HI Company Id: field value is missing in the record.');
	}

	/**
	 * @Author      : Bhagat singh
	 * @Description : Process enrollment_ready_for_processing Event : Negative Case - State Carrier information missing
	 **/
	static testMethod void validateCarrierInformation() {
		Test.startTest();
		HIFulfillmentEventTriggerHelper.queue = true;
		HI_Fulfillment_Event__c objHiEvent = new TestDataFactory.HIFulfillmentEventBuilder()
			.setId('Test321')
			.setEventType('enrollment_ready_for_processing')
			.setEventInfo(
				'{"error_message":"test error","enrollment":{"id":47431,"employee_id":7757869431613363,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/enrollments/47431"},"recent_qles":[],"carrier_directory":"https://confluence.gustocorp.com/pages/viewpage.action?pageId=28803132","employee":{"id":7757869431613363,"first_name":"Vincent","last_name":"Smitham","middle_initial":"M","status":"Active","ssn":"123456789","birthday":"1985-03-12","company_id":7757616923599114,"hired_at":"2014-05-12","employment_status":"full_time","home_address":{"id":7757727713689401,"street_1":"4349 Bradley Circles","street_2":"Suite 826","city":"Los Angeles","county_name":"Los Angeles","state":"CA","zip":"90027","country":"USA","phone":null,"created_at":"2016-12-14T14:36:45.000-08:00","updated_at":"2016-12-14T14:36:45.000-08:00","fax":null,"inactive":false,"work_address":false},"work_address":{"id":7757727713687976,"street_1":"427 O\'Reilly Ramp","street_2":"Suite 475","city":"Los Angeles","county_name":"Los Angeles","state":"CA","zip":"90029","country":"USA","phone":"8899664872","created_at":"2016-12-13T17:35:24.000-08:00","updated_at":"2016-12-13T17:35:24.000-08:00","fax":null,"inactive":false,"work_address":true,"employee_count":6},"email":"schuyler.muller7757869449033705@turcottefisher.info","gender":"male","panda_url":"http://manage.zenpayroll.dev:3000/companies/7757616923599114/employees/7757869431613363","hippo_url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363"},"company":{"id":7757616923599114,"name":"Kihn, Cole and Turner","email":"justyn_dickens7757869449032810@bednar.com","salesforce_account_id":null,"work_states":["CA"],"sic_code":"6794","mailing_address":{"id":7757727713687976,"street_1":"427 O\'Reilly Ramp","street_2":"Suite 475","city":"Los Angeles","county_name":"Los Angeles","state":"CA","zip":"90029","country":"USA","phone":"8899664872","created_at":"2016-12-13T17:35:24.000-08:00","updated_at":"2016-12-13T17:35:24.000-08:00","fax":null,"inactive":false,"work_address":true,"employee_count":6},"filing_address":{"id":7757727713687976,"street_1":"427 O\'Reilly Ramp","street_2":"Suite 475","city":"Los Angeles","county_name":"Los Angeles","state":"CA","zip":"90029","country":"USA","phone":"8899664872","created_at":"2016-12-13T17:35:24.000-08:00","updated_at":"2016-12-13T17:35:24.000-08:00","fax":null,"inactive":false,"work_address":true,"employee_count":6},"benefits_address":{"id":7757727713687976,"street_1":"427 O\'Reilly Ramp","street_2":"Suite 475","city":"Los Angeles","county_name":"Los Angeles","state":"CA","zip":"90029","country":"USA","phone":"8899664872","created_at":"2016-12-13T17:35:24.000-08:00","updated_at":"2016-12-13T17:35:24.000-08:00","fax":null,"inactive":false,"work_address":true,"employee_count":6},"number_of_eligible_ees":6,"number_of_ineligible_ees":0,"has_federal_cobra":null,"is_suspended":false,"panda_url":"http://manage.zenpayroll.dev:3000/companies/7757616923599114","hippo_url":"http://localhost:4001/companies/7757616923599114"},"state_carriers":[],"benefit_items":{"dental":{"current":null,"overlapping":[{"id":53794,"policy_id":15619,"benefit_type":"dental","subscriber_id":"22270388","start_date":"2017-03-01","end_date":"2018-02-28","processed":true,"enrollment_id":25666,"employee_id":7757869431613363,"dependent_ids":[],"state_carrier_id":24,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/53794"}],"previous":[]},"medical":{"current":{"id":98828,"policy_id":15841,"benefit_type":"medical","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":47431,"employee_id":7757869431613363,"dependent_ids":[16918],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/98828","estimated_start_date":"2017-05-26","estimated_total_premium":763.9,"estimated_employee_premium":375.63,"estimated_dependents_premium":388.27,"ops_owner":"member_fulfillment"},"overlapping":[{"id":53793,"policy_id":15842,"benefit_type":"medical","subscriber_id":"61306767","start_date":"2017-03-01","end_date":"2018-02-28","processed":true,"enrollment_id":25666,"employee_id":7757869431613363,"dependent_ids":[],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/53793"}],"previous":[]},"long_term_disability":{"current":{"id":98829,"policy_id":15841,"benefit_type":"long_term_disability","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":47431,"employee_id":7757869431613363,"dependent_ids":[16918],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/98828","estimated_start_date":"2017-05-26","estimated_total_premium":763.9,"estimated_employee_premium":375.63,"estimated_dependents_premium":388.27,"ops_owner":"member_fulfillment"},"overlapping":[{"id":53794,"policy_id":15842,"benefit_type":"long_term_disability","subscriber_id":"61306767","start_date":"2017-03-01","end_date":"2018-02-28","processed":true,"enrollment_id":25666,"employee_id":7757869431613363,"dependent_ids":[],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/53793"}],"previous":[]},"short_term_disability":{"current":{"id":98830,"policy_id":15841,"benefit_type":"short_term_disability","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":47431,"employee_id":7757869431613363,"dependent_ids":[16918],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/98828","estimated_start_date":"2017-05-26","estimated_total_premium":763.9,"estimated_employee_premium":375.63,"estimated_dependents_premium":388.27,"ops_owner":"member_fulfillment"},"overlapping":[{"id":53795,"policy_id":15842,"benefit_type":"short_term_disability","subscriber_id":"61306767","start_date":"2017-03-01","end_date":"2018-02-28","processed":true,"enrollment_id":25666,"employee_id":7757869431613363,"dependent_ids":[],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/53793"}],"previous":[]},"life":{"current":{"id":98831,"policy_id":15841,"benefit_type":"life","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":47431,"employee_id":7757869431613363,"dependent_ids":[16918],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/98828","estimated_start_date":"2017-05-26","estimated_total_premium":763.9,"estimated_employee_premium":375.63,"estimated_dependents_premium":388.27,"ops_owner":"member_fulfillment"},"overlapping":[{"id":53796,"policy_id":15842,"benefit_type":"life","subscriber_id":"61306767","start_date":"2017-03-01","end_date":"2018-02-28","processed":true,"enrollment_id":25666,"employee_id":7757869431613363,"dependent_ids":[],"state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/53793"}],"previous":[]},"vision":{"current":{"id":98829,"policy_id":15634,"benefit_type":"vision","subscriber_id":null,"start_date":null,"end_date":null,"processed":false,"enrollment_id":47431,"employee_id":7757869431613363,"dependent_ids":[16918],"state_carrier_id":24,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions/98829","estimated_start_date":"2017-05-26","estimated_total_premium":19.51,"estimated_employee_premium":9.68,"estimated_dependents_premium":9.83,"ops_owner":"member_fulfillment"},"overlapping":[],"previous":[]}},"policies":[{"id":15619,"name":"Principal Dental Plan 4","benefit_type":"dental","group_number":"1073605-10001","policy_number":null,"plan_id":2224,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":24,"url":"http://localhost:4001/companies/7757616923599114/policies/15619"},{"id":15631,"name":"Silver 70 HMO 1000/50 + Child Dental Alt","benefit_type":"medical","group_number":"344089","policy_number":null,"plan_id":2419,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/policies/15631"},{"id":15634,"name":"Principal Vision Plan 2","benefit_type":"vision","group_number":"","policy_number":null,"plan_id":1975,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":24,"url":"http://localhost:4001/companies/7757616923599114/policies/15634"},{"id":15841,"name":"Platinum 90 HMO 0/10 + Child Dental Alt","benefit_type":"medical","group_number":"","policy_number":null,"plan_id":2413,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/policies/15841"},{"id":15842,"name":"Gold 80 HMO 0/30 w/ Child Dental, Acu","benefit_type":"medical","group_number":"","policy_number":null,"plan_id":2410,"visible":true,"termination_policy":"last_day_of_month_on_or_after_termination","state_carrier_id":5,"url":"http://localhost:4001/companies/7757616923599114/policies/15842"}],"dependents":[{"id":16918,"first_name":"Doug","last_name":"Wintheiser","ssn":"123456789","birthday":"1983-07-03","gender":"female","dependent_type":"spouse","employee_id":7757869431613363,"url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/dependents/16918"}],"forms":[{"id":88268,"name":"2017 Kaiser CA Employee Change Form","url":"http://localhost:4001/attachments/forms/88268","carrier_id":5,"state_carrier_id":5}],"answers":[],"benefits_url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/subscriptions","enrollments_url":"http://localhost:4001/companies/7757616923599114/employees/7757869431613363/enrollments"}'
			)
			.build();
		insert objHiEvent;

		Test.stopTest();

		List<HI_Fulfillment_Event__c> list_HIFulfillmentEvents = [SELECT Message__c, Processing_State__c FROM HI_Fulfillment_Event__c WHERE Id = :objHiEvent.Id];
		System.assertEquals(list_HIFulfillmentEvents[0].Processing_State__c, IntegrationUtils.DEAD_STATE);
		System.assertEquals(list_HIFulfillmentEvents[0].Message__c, 'State Carrier information does not exist.');
	}
}