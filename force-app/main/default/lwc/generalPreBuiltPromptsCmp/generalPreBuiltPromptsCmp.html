<template>
	<template if:true={showSpinner}>
		<div class="slds-is-relative">
			<lightning-spinner alternative-text="Loading" size="large"></lightning-spinner>
		</div>
	</template>
	<template if:true={startChat}>
		<section role="log" class="slds-chat" style="background-color: white; border-style: solid; border-color: #00000042; border-radius: 5px; border-width: 1px">
			<ul class="slds-chat-list">
				<li class="slds-chat-listitem slds-chat-listitem_bookend" style="margin-top: 3px">
					<div class="slds-chat-bookend">
						<p>This feature allows you to ask questions to quickly retrieve and summarize customer interactions. Please note, responses are generated by AI, check important info before taking action.</p>
					</div>
				</li>
				<div style="max-height: 350px; overflow: scroll; height: 350px" data-id="redDiv">
					<template if:true={conversation}>
						<template for:each={conversation} for:item="conv">
							<li key={conv.time} class={conv.class}>
								<div class="slds-chat-message">
									<div class="slds-chat-message__body">
										<div class={conv.class2}>
											<lightning-formatted-rich-text value={conv.message}> </lightning-formatted-rich-text>
										</div>
										<div class="slds-chat-message__meta" aria-label="said Amber Cann at 5:23 PM">{conv.user_name} â€¢ {conv.time}</div>
									</div>
								</div>
							</li>
						</template>
					</template>
					<div style="height: 120px"></div>
				</div>

				<template if:true={showThinking}>
					<li class="slds-chat-listitem slds-chat-listitem_inbound">
						<div class="slds-chat-message">
							<div class="slds-chat-message__body">
								<div class="slds-chat-message__text slds-chat-message__text_inbound">
									<span class="slds-icon-typing slds-is-animated" title="Customer is typing">
										<span class="slds-icon-typing__dot"></span>
										<span class="slds-icon-typing__dot"></span>
										<span class="slds-icon-typing__dot"></span>
										<span class="slds-assistive-text">Customer is typing</span>
									</span>
								</div>
							</div>
						</div>
					</li>
				</template>
				<li class="slds-chat-listitem slds-chat-listitem_outbound">
					<div style="display: flex">
						<div>
							<template if:true={showGlobalActions}>
								<template for:each={globalActions} for:item="acc">
									<lightning-button
										variant="brand"
										disabled={disableButtons}
										label={acc.Action_Name__c}
										title="Download action with brand variant"
										data-name={acc.Action_Name__c}
										data-desc={acc.Description__c}
										data-id={acc.Id}
                                        data-global="true"
										onclick={handleAction}
										key={acc.Action_Name__c}
										class="slds-m-left_x-small"
									></lightning-button>
								</template>
							</template>
						</div>
						<div>
							<template if:true={showObjectActions}>
								<lightning-button-menu alternative-text="Show menu" class="slds-m-left_large" menu-alignment="right" label="Question Bank">
									<template for:each={objectActions} for:item="acc">
										<lightning-menu-item
											key={acc.Action_Name__c}
											value="MenuItemOne"
											label={acc.Action_Name__c}
											data-name={acc.Action_Name__c}
											data-desc={acc.Description__c}
											data-id={acc.Id}
											onclick={handleAction}
                                            data-global="false"
										></lightning-menu-item>
									</template>
								</lightning-button-menu>
							</template>
						</div>
					</div>
				</li>

				<li class="slds-chat-listitem slds-chat-listitem_bookend">
					<div class="slds-chat-bookend slds-chat-bookend_stop">
						<lightning-icon icon-name="utility:engage" alternative-text="Warning!" title="Warning" size="x-small"></lightning-icon>
						<p><span style="margin-right: 5px;"> Please select an action to start the interaction.</span></p>
					</div>
				</li>
			</ul>
		</section>
	</template>
	<template if:false={startChat}>
		<div style="width: 100%">
			<lightning-button variant="brand" label="Customer Insights Assistant" onclick={startChatHandler} class="slds-m-left_x-small start-chat"></lightning-button>
		</div>
	</template>
</template>