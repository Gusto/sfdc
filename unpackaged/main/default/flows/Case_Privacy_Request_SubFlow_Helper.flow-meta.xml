<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Send_Email_to_Legal</name>
        <label>Send Email to Legal</label>
        <locationX>314</locationX>
        <locationY>398</locationY>
        <actionName>Case.Email_legal_approval_for_privacy_request</actionName>
        <actionType>emailAlert</actionType>
        <connector>
            <targetReference>Skip_Trigger</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>objCase.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>Case.Email_legal_approval_for_privacy_request</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <name>Send_Identity_Denial_Email</name>
        <label>Send Identity Denial Email</label>
        <locationX>578</locationX>
        <locationY>518</locationY>
        <actionName>Case.Privacy_Request_Identity_Denial</actionName>
        <actionType>emailAlert</actionType>
        <connector>
            <targetReference>Skip_Trigger</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>objCase.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>Case.Privacy_Request_Identity_Denial</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <name>Send_Location_Denial_Email</name>
        <label>Send Location Denial Email</label>
        <locationX>842</locationX>
        <locationY>518</locationY>
        <actionName>Case.Privacy_Request_Location_Denial</actionName>
        <actionType>emailAlert</actionType>
        <connector>
            <targetReference>Skip_Trigger</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>objCase.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>Case.Privacy_Request_Location_Denial</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <name>Send_Submission_Email</name>
        <label>Send Submission Email</label>
        <locationX>50</locationX>
        <locationY>518</locationY>
        <actionName>Case.Privacy_Request_Submission</actionName>
        <actionType>emailAlert</actionType>
        <connector>
            <targetReference>Skip_Trigger</targetReference>
        </connector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>SObjectRowId</name>
            <value>
                <elementReference>objCase.Id</elementReference>
            </value>
        </inputParameters>
        <nameSegment>Case.Privacy_Request_Submission</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <actionCalls>
        <description>This invokable method will skip CaseTriggerHelper class.</description>
        <name>Skip_Trigger</name>
        <label>Skip Trigger</label>
        <locationX>578</locationX>
        <locationY>734</locationY>
        <actionName>CaseTriggerHelper</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Update_objCase</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Update_objCase</targetReference>
        </faultConnector>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>booleanList</name>
            <value>
                <elementReference>blnSkipTrigger</elementReference>
            </value>
        </inputParameters>
        <nameSegment>CaseTriggerHelper</nameSegment>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <apiVersion>56.0</apiVersion>
    <assignments>
        <description>Initializing Fault Line details for fault paths in objExceptionLogEvent record.</description>
        <name>Initializing_Fault_Line_Details</name>
        <label>Initializing Fault Line Details</label>
        <locationX>578</locationX>
        <locationY>158</locationY>
        <assignmentItems>
            <assignToReference>objExceptionLogEvent.Message__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>strExceptionLogMessage</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objExceptionLogEvent.EventUuid</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Flow.InterviewGuid</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objExceptionLogEvent.Method_Name__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Flow.CurrentStage</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objExceptionLogEvent.Type__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Flow</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Check_Status</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Update objExceptionLogMessage with Fault Line details.</description>
        <name>Update_objCase_Failed</name>
        <label>Update objCase Failed</label>
        <locationX>1282</locationX>
        <locationY>974</locationY>
        <assignmentItems>
            <assignToReference>objExceptionLogEvent.Method_Name__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Flow.CurrentStage</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Exception_Log_Event</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Check_Status</name>
        <label>Check Status</label>
        <locationX>578</locationX>
        <locationY>278</locationY>
        <defaultConnector>
            <targetReference>Skip_Trigger</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Submitted</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>objCase.Status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Submitted</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>objCase.Privacy_Requester_Email__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Attach_to_Case</targetReference>
            </connector>
            <label>Submitted</label>
        </rules>
        <rules>
            <name>Verified_by_Risk</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>objCase.Status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Verified by Risk</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Send_Email_to_Legal</targetReference>
            </connector>
            <label>Verified by Risk</label>
        </rules>
        <rules>
            <name>Denied_b_c_of_Identity</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>objCase.Status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Request Denied</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>objCase.Privacy_Requester_Email__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>objCase.Status_Detail__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Identity</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Attach_to_Case2</targetReference>
            </connector>
            <label>Denied b/c of Identity</label>
        </rules>
        <rules>
            <name>Denied_b_c_of_Location</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>objCase.Privacy_Requester_Email__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>objCase.Status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Request Denied</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>objCase.Status_Detail__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Location</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Attach_to_Case3</targetReference>
            </connector>
            <label>Denied b/c of Location</label>
        </rules>
    </decisions>
    <description>Helper sub flow for Privacy Request case record type.</description>
    <environments>Default</environments>
    <interviewLabel>TEMPLATE: Case Helper Flow {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Case Privacy Request SubFlow Helper</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Attach_to_Case</name>
        <label>Attach to Case</label>
        <locationX>50</locationX>
        <locationY>398</locationY>
        <connector>
            <targetReference>Send_Submission_Email</targetReference>
        </connector>
        <inputAssignments>
            <field>FromAddress</field>
            <value>
                <stringValue>no-reply@gusto.com</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>HtmlBody</field>
            <value>
                <stringValue>&lt;html&gt;&lt;body&gt;We&apos;ve received your request. Once we have verified the request by reviewing the information you provided against our records, we&apos;ll update the status of the request in our California Consumer Privacy Act Request Portal and send you an email notification. You can expect a response from us within 45 days of the date of your request.&lt;/body&gt;&lt;/html&gt;</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>RelatedToId</field>
            <value>
                <elementReference>objCase.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Status</field>
            <value>
                <stringValue>3</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Subject</field>
            <value>
                <stringValue>California Consumer Privacy Act request received</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>ToAddress</field>
            <value>
                <elementReference>objCase.Privacy_Requester_Email__c</elementReference>
            </value>
        </inputAssignments>
        <object>EmailMessage</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordCreates>
        <name>Attach_to_Case2</name>
        <label>Attach to Case</label>
        <locationX>578</locationX>
        <locationY>398</locationY>
        <connector>
            <targetReference>Send_Identity_Denial_Email</targetReference>
        </connector>
        <inputAssignments>
            <field>FromAddress</field>
            <value>
                <stringValue>no-reply@gusto.com</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>HtmlBody</field>
            <value>
                <stringValue>&lt;html&gt;&lt;body&gt;Thank you for your inquiry. Unfortunately, we are unable to fulfill your request because we cannot verify your identity based on the information you have provided to us.  Please refer to our &lt;a href=&quot;https://gusto.com/about/privacy&quot; target=&quot;_blank&quot;&gt;Privacy Policy&lt;/a&gt; for information about our general business practices regarding the collection and maintenance of personal information.&lt;/body&gt;&lt;/html&gt;</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>RelatedToId</field>
            <value>
                <elementReference>objCase.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Status</field>
            <value>
                <stringValue>3</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Subject</field>
            <value>
                <stringValue>Update regarding your California Consumer Privacy Act request</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>ToAddress</field>
            <value>
                <elementReference>objCase.Privacy_Requester_Email__c</elementReference>
            </value>
        </inputAssignments>
        <object>EmailMessage</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordCreates>
        <name>Attach_to_Case3</name>
        <label>Attach to Case</label>
        <locationX>842</locationX>
        <locationY>398</locationY>
        <connector>
            <targetReference>Send_Location_Denial_Email</targetReference>
        </connector>
        <inputAssignments>
            <field>FromAddress</field>
            <value>
                <stringValue>no-reply@gusto.com</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>HtmlBody</field>
            <value>
                <stringValue>&lt;html&gt;&lt;body&gt;Thank you for your inquiry. Unfortunately, we are unable to fulfill your request because you do not fall within one of the following categories: &lt;br/&gt;  (i) a natural person who is a California resident,  &lt;br/&gt; (ii) a natural person who is a California resident, acting on behalf of your minor child &lt;br/&gt; or  &lt;br/&gt; (iii) a natural person or a person registered with the California Secretary of State, acting on behalf of a natural person who is a California resident and who has authorized you to act on their behalf.  &lt;br/&gt; Please refer to our &lt;a href=&quot;https://gusto.com/about/privacy&quot; target=&quot;_blank&quot;&gt;Privacy Policy&lt;/a&gt; for information about our general business practices regarding the collection and maintenance of personal information.&lt;/body&gt;&lt;/html&gt;</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>RelatedToId</field>
            <value>
                <elementReference>objCase.Id</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Status</field>
            <value>
                <stringValue>3</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Subject</field>
            <value>
                <stringValue>Update regarding your California Consumer Privacy Act request</stringValue>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>ToAddress</field>
            <value>
                <elementReference>objCase.Privacy_Requester_Email__c</elementReference>
            </value>
        </inputAssignments>
        <object>EmailMessage</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordCreates>
    <recordCreates>
        <description>Create Exception Log event from fault line details in objExceptionLogEvent</description>
        <name>Exception_Log_Event</name>
        <label>Exception Log Event</label>
        <locationX>1282</locationX>
        <locationY>1094</locationY>
        <inputReference>objExceptionLogEvent</inputReference>
    </recordCreates>
    <recordUpdates>
        <description>Final DML Update</description>
        <name>Update_objCase</name>
        <label>Update objCase</label>
        <locationX>578</locationX>
        <locationY>854</locationY>
        <faultConnector>
            <targetReference>Update_objCase_Failed</targetReference>
        </faultConnector>
        <inputReference>objCase</inputReference>
    </recordUpdates>
    <sourceTemplate>TEMPLATE_Case_Helper_Flow</sourceTemplate>
    <start>
        <locationX>452</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Initializing_Fault_Line_Details</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <textTemplates>
        <description>Exception Log Message containing flow details in a fault path.</description>
        <name>strExceptionLogMessage</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>Fault Message: {!$Flow.FaultMessage}
----
Interview Guid: {!$Flow.InterviewGuid}
----
Current Record: {!$Flow.CurrentRecord}
----
You can find failed flow interviews with the link below. The link below is for Production failed interviews, but if you would like to find them in another environment in Setup, simply search for ‘Paused and Failed Flow Interviews’ in Setup’s Quick Find bar, and switch to the All Failed Flow Interviews List View. You can use the interview &quot;Interview Guid&quot; above to locate this specific failures.  
https://gusto.lightning.force.com/lightning/setup/Pausedflows/home</text>
    </textTemplates>
    <variables>
        <description>Boolean for skipping Case Trigger</description>
        <name>blnSkipTrigger</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
        <value>
            <booleanValue>false</booleanValue>
        </value>
    </variables>
    <variables>
        <description>Case Object passed from Case Handler Flow.</description>
        <name>objCase</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>true</isOutput>
        <objectType>Case</objectType>
    </variables>
    <variables>
        <description>Exception Log Event Object to capture fault path details.</description>
        <name>objExceptionLogEvent</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
        <objectType>Exception_Log_Event__e</objectType>
    </variables>
</Flow>
