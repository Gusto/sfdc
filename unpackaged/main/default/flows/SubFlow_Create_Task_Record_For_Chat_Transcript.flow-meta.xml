<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>55.0</apiVersion>
    <assignments>
        <name>Fill_Account_Details_On_Chat_Transcript</name>
        <label>Fill Account Details On Chat Transcript</label>
        <locationX>50</locationX>
        <locationY>1514</locationY>
        <assignmentItems>
            <assignToReference>objChatTranscript.AccountId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Contact.AccountId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objChatTranscript.Company_Name__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>Get_Company_Name.Name</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_Chat_Transcript</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>New_Task_Record_Assigment</name>
        <label>New Task Record Assigment</label>
        <locationX>50</locationX>
        <locationY>878</locationY>
        <assignmentItems>
            <assignToReference>objTask.Subject</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ButtonNameWithDate</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objTask.Start_Date__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>objChatTranscript.StartTime</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objTask.Date_Completed__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>objChatTranscript.EndTime</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objTask.Type</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Chat</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objTask.OwnerId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>objChatTranscript.OwnerId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objTask.Chat_Transcript__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>objChatTranscript.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objTask.RecordTypeId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>ObjTask_RecordType_Id_Of_Standard.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objTask.WhoId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>CalculateWhoID</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objTask.WhatId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>CalculateWhatID</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Create_Task_Record</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Update_Task_Record_Assigment</name>
        <label>Update Task Record Assigment</label>
        <locationX>314</locationX>
        <locationY>878</locationY>
        <assignmentItems>
            <assignToReference>objTask.Start_Date__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>objChatTranscript.StartTime</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objTask.Date_Completed__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>objChatTranscript.EndTime</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objTask.ActivityDate</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Flow.CurrentDate</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>objTask.Status</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Completed</stringValue>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_Task_Record</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>AccountId_is_present</name>
        <label>AccountId is present</label>
        <locationX>182</locationX>
        <locationY>1298</locationY>
        <defaultConnectorLabel>No</defaultConnectorLabel>
        <rules>
            <name>Yes</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Get_Contact.AccountId</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Company_Name</targetReference>
            </connector>
            <label>Yes</label>
        </rules>
    </decisions>
    <decisions>
        <name>Chat_Button_Name_Is_Equal_To_And_Lead_Not_Equal_To_Null</name>
        <label>Chat Button Name Is Equal To And Lead Not Equal To Null</label>
        <locationX>842</locationX>
        <locationY>278</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>SBIZ_Sales_Reps</name>
            <conditionLogic>(1 OR 5) AND (2 OR 3 OR 4)</conditionLogic>
            <conditions>
                <leftValueReference>objChatButtonRecord.MasterLabel</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>SBIZ Sales Reps</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>objChatTranscript.LeadId</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>objChatTranscript.AccountId</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>objChatTranscript.ContactId</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>objChatButtonRecord.MasterLabel</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>GcorpV2</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Chat_Transcript_Status_Is_Equal_To</targetReference>
            </connector>
            <label>SBIZ Sales Reps And LeadId &lt;&gt; Null</label>
        </rules>
    </decisions>
    <decisions>
        <name>Chat_Transcript_Status_Is_Equal_To</name>
        <label>Chat Transcript Status Is Equal To</label>
        <locationX>578</locationX>
        <locationY>398</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>In_Progress_Or_Is_Completed</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>objChatTranscript.Status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>InProgress</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>objChatTranscript.Status</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Completed</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>objExistingTask</targetReference>
            </connector>
            <label>In Progress Or Is Completed</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_button_GcorpV2</name>
        <label>Check button GcorpV2</label>
        <locationX>380</locationX>
        <locationY>1082</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Account_details_can_be_updated</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>objChatButtonRecord.MasterLabel</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>GcorpV2</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>objChatTranscript.AccountId</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>objChatTranscript.ContactId</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_Contact</targetReference>
            </connector>
            <label>Account details can be updated</label>
        </rules>
    </decisions>
    <decisions>
        <name>Check_objTask_Is_Null_Or_Not</name>
        <label>Check objTask Is Null Or Not</label>
        <locationX>314</locationX>
        <locationY>758</locationY>
        <defaultConnectorLabel>Default Outcome</defaultConnectorLabel>
        <rules>
            <name>Is_Null</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>objTask</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>New_Task_Record_Assigment</targetReference>
            </connector>
            <label>Is Null</label>
        </rules>
        <rules>
            <name>Is_Not_Null</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>objTask</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_Task_Record_Assigment</targetReference>
            </connector>
            <label>Is Not Null</label>
        </rules>
    </decisions>
    <formulas>
        <name>ButtonNameWithDate</name>
        <dataType>String</dataType>
        <expression>&apos;Chat: &apos;&amp; {!objChatButtonRecord.MasterLabel} &amp;&apos; &apos;&amp; TEXT(TODAY())</expression>
    </formulas>
    <formulas>
        <name>CalculateWhatID</name>
        <dataType>String</dataType>
        <expression>IF(
	NOT(ISBLANK({!objChatTranscript.Opportunity__c})), 
		{!objChatTranscript.Opportunity__c}, 
		IF(
			NOT(ISBLANK({!objChatTranscript.AccountId})),
			{!objChatTranscript.AccountId},
			null)
)</expression>
    </formulas>
    <formulas>
        <name>CalculateWhoID</name>
        <dataType>String</dataType>
        <expression>IF(
	NOT(ISBLANK({!objChatTranscript.ContactId})), {!objChatTranscript.ContactId},
	IF(
	AND (ISBLANK({!objChatTranscript.AccountId}), ISBLANK({!objChatTranscript.Opportunity__c})),
	IF (
	NOT(ISBLANK({!objChatTranscript.LeadId})), {!objChatTranscript.LeadId}, 
	NULL), NULL)
)</expression>
    </formulas>
    <formulas>
        <name>ChatTranscriptURL</name>
        <dataType>String</dataType>
        <expression>LEFT({!$Api.Partner_Server_URL_260}, FIND( &apos;/services&apos;, {!$Api.Partner_Server_URL_260})) + &quot;lightning/r/LiveChatTranscript/&quot; + {!objChatTranscript.Id}+ &quot;/view&quot;</expression>
    </formulas>
    <interviewLabel>Subflow: Create Task Record For Chat {!$Flow.CurrentDateTime}</interviewLabel>
    <label>SubFlow: Create Task Record For Chat Transcript</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordCreates>
        <name>Create_Task_Record</name>
        <label>Create Task Record</label>
        <locationX>50</locationX>
        <locationY>998</locationY>
        <connector>
            <targetReference>Check_button_GcorpV2</targetReference>
        </connector>
        <inputReference>objTask</inputReference>
    </recordCreates>
    <recordLookups>
        <name>Get_Company_Name</name>
        <label>Get Company Name</label>
        <locationX>50</locationX>
        <locationY>1406</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Fill_Account_Details_On_Chat_Transcript</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Get_Contact.AccountId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Account</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>Name</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_Contact</name>
        <label>Get Contact</label>
        <locationX>182</locationX>
        <locationY>1190</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>AccountId_is_present</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>objChatTranscript.ContactId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Contact</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>AccountId</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>objChatButtonRecord</name>
        <label>objChatButtonRecord</label>
        <locationX>842</locationX>
        <locationY>158</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Chat_Button_Name_Is_Equal_To_And_Lead_Not_Equal_To_Null</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>objChatTranscript.LiveChatButtonId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>LiveChatButton</object>
        <queriedFields>Id</queriedFields>
        <queriedFields>MasterLabel</queriedFields>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>objExistingTask</name>
        <label>objExistingTask</label>
        <locationX>314</locationX>
        <locationY>518</locationY>
        <assignNullValuesIfNoRecordsFound>true</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>ObjTask_RecordType_Id_Of_Standard</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Chat_Transcript__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>objChatTranscript.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>Type</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Chat</stringValue>
            </value>
        </filters>
        <object>Task</object>
        <outputReference>objTask</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Subject</queriedFields>
        <queriedFields>Start_Date__c</queriedFields>
        <queriedFields>ActivityDate</queriedFields>
        <queriedFields>Date_Completed__c</queriedFields>
        <queriedFields>Status</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>ObjTask_RecordType_Id_Of_Standard</name>
        <label>ObjTask RecordType Id Of Standard</label>
        <locationX>314</locationX>
        <locationY>638</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Check_objTask_Is_Null_Or_Not</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>SobjectType</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Task</stringValue>
            </value>
        </filters>
        <filters>
            <field>DeveloperName</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Standard</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>RecordType</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Update_Chat_Transcript</name>
        <label>Update Chat Transcript</label>
        <locationX>50</locationX>
        <locationY>1622</locationY>
        <inputReference>objChatTranscript</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_Task_Record</name>
        <label>Update Task Record</label>
        <locationX>314</locationX>
        <locationY>998</locationY>
        <connector>
            <targetReference>Check_button_GcorpV2</targetReference>
        </connector>
        <inputReference>objTask</inputReference>
    </recordUpdates>
    <start>
        <locationX>716</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>objChatButtonRecord</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <variables>
        <name>objChatTranscript</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <objectType>LiveChatTranscript</objectType>
    </variables>
    <variables>
        <name>objTask</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Task</objectType>
    </variables>
</Flow>
